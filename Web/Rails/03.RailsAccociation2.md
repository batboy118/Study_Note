# 03. Rails - Associations 2

[ğŸ Home](https://github.com/batboy118/Study_Note)

[â—€Previous page ](./README.md)

---

<!-- TOC -->

- [1. ë” ë§ì€ ëª¨ë¸ ì‚¬ìš©í•˜ê¸°](#1-ë”-ë§ì€-ëª¨ë¸-ì‚¬ìš©í•˜ê¸°)

<!-- /TOC -->

## 1. ë” ë§ì€ ëª¨ë¸ ì‚¬ìš©í•˜ê¸°

ì§€ê¸ˆ ê¹Œì§€ `has_many` / `belongs_to` associationì„ ì´ìš©í•œ one-to-many relationshipì„ í‘œí˜„í–ˆë‹¤. í•˜ì§€ë§Œ ì˜í™”ë¡œ ì˜ˆë¥¼ ë“¤ì–´ë³´ë©´, ë§ì€ ë°°ìš°ê°€ í•œ ì˜í™”ì— ì¶œì—°í•˜ê³ , ë˜ ë°˜ëŒ€ë¡œ í•œ ë°°ìš°ê°€ ì—¬ëŸ¬ ì˜í™”ì— ì¶œì—°í•˜ê¸°ë„ í•œë‹¤. ì´ëŸ¬í•œ ì¢…ë¥˜ì˜ ë°ì´í„°ë¥¼ ëª¨ë¸ë§í•˜ê¸° ìœ„í•´ *many-to-many relationship*ì„ ì´ìš©í•´ì•¼ í•œë‹¤.

ë¨¼ì €  `MovieApp` ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“¤ê³  gemfileì„ ì¸ìŠ¤í†¨í•œë‹¤.

ê·¸ë¦¬ê³  Movie, Actor, Part ì´ 3ê°œì˜ ëª¨ë¸ì„ ìƒì„±í•œë‹¤.

ì•„ë˜ ëª¨ë¸ íŒŒì¼ë“¤ì„ ì„¤ì •í•´ ì¤€ë‹¤.

**app/models/movie.rb**

```ruby
has_many :parts
has_many :actors, through: :parts
```

**app/models/actor.rb**

```ruby
has_many :parts
has_many :movies, through: :parts
```

**app/models/part.rb**

```ruby
belongs_to :movie
belongs_to :actor
```

> `has_many :through` association ì€  `Movie` modelê³¼  `Actor` modelì„  `Part` modelì„ í†µí•´ì—¬ ê²°í•©ì‹œì¼œì¤€ë‹¤.
>
> `has_many :through` associationì„ ì´ìš©í•˜ì—¬ moviesì™€ actors ì‚¬ì´ì˜ many-to-many relationshipì„ ë§Œë“¤ìˆ˜ ìˆë‹¤.

ì´ì œëŠ” migrationíŒŒì¼ì„ ì„¤ì •í•´ë³´ì.

**the movies table**

- a `string` column called `title`
- a `string` column called `image`
- a `string` column called `release_year`
- a `string` column called `plot`

```ruby
class CreateMovies < ActiveRecord::Migration
  def change
    create_table :movies do |t|
			t.string :title
			t.string :image
			t.string :release_year
			t.string :plot
      t.timestamps
    end
  end
end
```

**the actors table**

- a `string` column called `first_name`
- a `string` column called `last_name`
- a `string` column called `image`
- a `string` column called `bio`

```ruby
class CreateActors < ActiveRecord::Migration
  def change
    create_table :actors do |t|
			t.string :first_name
			t.string :last_name
			t.string :image
			t.string :bio
      t.timestamps
    end
  end
end
```

**the parts table**

movieì™€ actor í…Œì´ë¸”ì„ ê°€ë¦¬í‚¤ëŠ” foreign keysë¥¼ ì¶”ê°€í•œë‹¤.

```ruby
class CreateParts < ActiveRecord::Migration
  def change
    create_table :parts do |t|
			t.belongs_to :movie, index: true
			t.belongs_to :actor, index: true
      t.timestamps
    end
  end
end
```

 `t.belongs_to` methodë¥¼ ì´ìš©í•´ many-to-manyê´€ê³„ë¥¼ ìœ„í•œ foreign keysë¥¼ ì¶”ê°€í–ˆë‹¤.

ë¨¼ì €, í…Œì´ë¸” ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ì§„í–‰í•˜ê³ , seeds.rbíŒŒì¼ì— ë°ì´í„°ê°€ ìˆë‹¤ê³ ê°€ì •í•˜ê³  seedë„ ì§„í–‰í•œë‹¤.

ì´ì œ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ìƒì„±í•´ ë³´ì.

Movies ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ìƒì„±í•˜ê³  indexì™€ showì„ ì ì ˆí•˜ê²Œ ë¼ìš°íŒ…í•´ì¤€ë‹¤.

ê·¸ í›„, indexì™€ showì•¡ì…˜ì„ ì‘ì„±í•œë‹¤.

```ruby
class MoviesController < ApplicationController
  def index
    @movies = Movie.all
  end

  def show
    @movie = Movie.find(params[:id])
    @actors = @movie.actors
  end
end
```

ë·° í…œí”Œë¦¿ë„ ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í•œë‹¤.

**app/views/movies/index.html.erb**

```erb
<div class="hero">
  <div class="container">
    <h2>Interstellar</h2>
    <p>Former NASA pilot Cooper (Matthew McConaughey) and a team of researchers travel across the galaxy to find out which of three planets could be mankind's new home.</p>
    <a href="#">Read More</a>
  </div>
</div>

<div class="main">
  <div class="container">
  <h2>Popular Films</h2>

    <% @movies.each do |movie| %>
    <div class="movie">
      <img src="<%= movie.image %>">
      <h3> <%= movie.title %> </h3>
      <p> <%= movie.release_year %> </p>
    <%=link_to "Learn more", movie_path(movie)%>
    </div>

    <% end %>

  </div>
</div>
```

**app/views/movies/show.html.erb**

```erb
<div class="main movie-show">
  <div class="container">
    <div class="movie">

      <!-- Display the movie's info here -->
      <div class="info">
        <=%image_tag(@movie.image)%>
        <h3 class="movie-title"> <%=@movie.title%> </h3>
        <p class="movie-release-year"> <%=@movie.release_year%> </p>
        <p class="movie-plot"> <%=@movie.plot%> </p>
      </div>
    </div>

    <h2>Cast</h2>
    <!-- Display each actor's info here -->
    <% @actors.each do |actor| %>
      <div class="actor">
        <%=image_tag(actor.image)%>
        <h3 class="actor-name">  <%=actor.first_name + ' ' +actor.last_name%> </h3>
        <p class="actor-bio">  <%=actor.bio%> </p>
      </div>
    <% end %>

  </div>
</div>
```

ì§€ê¸ˆê¹Œì§€ëŠ” í•œ ì˜í™”ì— ì¶œì—°í•œ ëª¨ë“  ë°°ìš°ë“¤ì„ ë³´ì—¬ì£¼ëŠ” ì‘ì—…ì„ í–ˆë‹¤.

ì´ì œëŠ” ë°˜ëŒ€ë¡œ, í•œ ë°°ìš°ê°€ ì¶œì—°í•œ ëª¨ë“  ì˜í™”ë¥¼ í™”ë©´ì— ë³´ì—¬ì£¼ëŠ” ì‘ì—…ì„ í•˜ì.

Actors ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ìƒì„±í•œë‹¤. ê·¸ë¦¬ê³  ëª¨ë“  ë°°ìš°ë¥¼ ë³´ì—¬ì¤„ ìˆ˜ ìˆëŠ” í™”ë©´ì¸ `/actors`í™”ë©´ì„ Actorsì»¨íŠ¸ë¡¤ëŸ¬ì˜ indexì•¡ì…˜ì— ë§µí•‘ì‹œí‚¨ë‹¤.

Avctorsì»¨íŠ¸ë¡¤ëŸ¬ì— indexì™€ show ì•¡ì…˜ì„ ì¶”ê°€í•œë‹¤.

```ruby
class ActorsController < ApplicationController
  def index
    @actors = Actor.all
  end

  def show
    @actor = Actor.find(params[:id])
    @movies = @actor.movies
  end
end
```

ë·°í…œí”Œë¦¿ë„ ì•„ë˜ì™€ ê°™ì´ ì„¤ì •í•´ì¤€ë‹¤.

**app/views/actors/index.html.erb**

```erb
<div class="main actor-index">
      <div class="container">
        <div class="row">

          <!--
          To do: Loop through movies and display each one with this HTML
          <div class="actor col-xs-2">
            actor image goes here
            <h3> actor name goes here </h3>
            <p> actor bio goes here </p>
          </div>
          -->

      </div>
</div>
```

**app/views/actors/index.html.erb**

```erb
<div class="main actor-show">
  <div class="container">

    <!-- Display an actor's info here -->
    <div class="actor">
      <!-- actor image -->
      <div class="info">
        <h3 class="actor-name">  </h3>
        <p class="actor-bio">  </p>
      </div>
    </div>

    <h2>Movies</h2>
    <!-- Display each movie's info here -->
    <div class="movie">
      <!-- movie image -->
      <h3 class="movie-title">  </h3>
      <p class="movie-release-year">  </p>
      <p class="movie-plot">  </p>
    </div>

  </div>
</div>
```



í•µì‹¬ì„ ì •ë¦¬í•´ë³´ë©´ ì•„ë˜ì™€ ê°™ë‹¤.

> - Actors and movies can be modeled using a *many-to-many* relationship. In Rails, this can be implemented using a `has_many :through` association.
> - The `has_many :through` association joins two models via a third model.
