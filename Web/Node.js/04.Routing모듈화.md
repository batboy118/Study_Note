# 04. Routing ëª¨ë“ˆí™”

> ë¼ìš°íŒ…ì„ ëª¨ë“ˆí™” í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ í•™ìŠµ

[ğŸ Home](https://github.com/batboy118/Study_Note)

[â—€Previous page ](./README.md)

---

<!-- TOC -->

- [1. Routing ëª¨ë“ˆí™”](#1-routing-ëª¨ë“ˆí™”)
- [2. Routing ë¦¬íŒ©í† ë§](#2-routing-ë¦¬íŒ©í† ë§)

<!-- /TOC -->

## 1.  Routing ëª¨ë“ˆí™”

url ë¼ìš°íŒ…ì„ í•´ì£¼ëŠ” ì½”ë“œê°€ ì ì  ëŠ˜ì–´ë‚˜ë©´ì„œ ì½”ë“œê°€ ì§€ì €ë¶„í•´ ì§„ë‹¤. ë¼ìš°íŒ…í•´ì£¼ëŠ” ì½”ë“œë¥¼ ë”°ë¡œ íŒŒì¼ë¡œ ë§Œë“¤ì–´ ëª¨ë“ˆí™”ë¥¼ í•´ì£¼ë©´ ê°€ë…ì„± ì¢‹ì€ ì½”ë“œë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

ìµœìƒìœ„ ë””ë ‰í† ë¦¬ì—ì„œ `router`ë¼ëŠ” ë””ë ‰í† ë¦¬ë¥¼ ìƒì„±í•˜ê³  ë‚´ë¶€ì— `main.js`íŒŒì¼ì„ ìƒì„±í•œë‹¤.

```javascript
//main.js
const express = require('express');
//express ê°ì²´ì— ìˆëŠ” Router ë©”ì†Œë“œ
const router = express.Router();

//ìƒëŒ€ê²½ë¡œ ì‚¬ìš©ì„ ìœ„í•œ path ëª¨ë“ˆ
const path = require('path');

router.get('/',(req,res)=>{
	res.sendFile(path.join(__dirname, '../public/main.html'));
})

//ë¼ìš°í„°ë¥¼ ëª¨ë“ˆë¡œ exportí•œë‹¤. ë‹¤ë¥¸ íŒŒì¼ì—ì„œ ì´ ëª¨ë“ˆì„ ì½ì–´ì™€ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
module.exports = router;
```

- `const express = require('express');`
  - express ëª¨ë“ˆ ì‚¬ìš©
- `const router = express.Router();`
  - expressì˜ ë¼ìš°í„° ë©”ì†Œë“œ ì‚¬ìš©
- `const path = require('path');`
  - ìƒëŒ€ ê²½ë¡œ ì‚¬ìš©ì„ ìœ„í•œ path ëª¨ë“ˆ ì‚¬ìš©
- `router.get`
  - ë¼ìš°í„° ê°ì²´ë¥¼ ì´ìš©í•˜ì—¬ get ë©”ì†Œë“œì— ëŒ€í•œ ë¼ìš°íŒ…

- `module.exports = router;`
  - ì„¤ì •ëœ ë¼ìš°í„° ê°ì²´ë¥¼ ëª¨ë“ˆë¡œ exportí•´ì¤€ë‹¤.
- `path.join(__dirname, '../public/main.html')`
  - path ëª¨ë“ˆì˜ `join` ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒëŒ€ê²½ë¡œ ( ex : `../`)ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```javascript
//app.js
const express = require('express');
const app = express()
const port = 3000
const bodyParser = require('body-parser');
const mysql = require('mysql');

//main.js ë¼ìš°í„° ëª¨ë“ˆ ì¶”ê°€
const main = require('./router/main')

const connection = mysql.createConnection({
	host : 'localhost',
	port : 3306 , //default í¬íŠ¸
	user : 'root',
	pasword : "",
	database : 'jsman'
})

connection.connect(); // ì»¤ë„¥ì…˜ ê°ì²´ì—ì„œ connectë¼ëŠ” ë©”ì†Œë“œë¥¼ ì‹¤í–‰í•œë‹¤.

app.listen(port, function() {
	console.log("start express server on port 3000");
})

app.use(express.static("public"))
app.use(bodyParser.json())
app.use(bodyParser.urlencoded({extended:true}))
app.set('view engine', 'ejs')

// /mainìœ¼ë¡œ ë“¤ì–´ì˜¤ë©´ ë¶ˆëŸ¬ì˜¨ ë¼ìš°í„° ëª¨ë“ˆì •ë³´ë¥¼ ì‚¬ìš©í•œë‹¤.
app.use('/main', main);
```

- `app.use('/main', main);`
  - `url`ì´ /mainìœ¼ë¡œ ë“¤ì–´ì˜¤ë©´ ë¶ˆëŸ¬ì˜¨ ë¼ìš°í„° ëª¨ë“ˆì •ë³´ë¥¼ ì‚¬ìš©í•œë‹¤.
  - `main.js` ë‚´ë¶€ì—ì„œëŠ”  `'/'`ë¡œ ì„¤ì •ì„ í•´ì•¼ `ì£¼ì†Œ/main`ì— ì ‘ê·¼í–ˆì„ ë•Œ í•´ë‹¹ ìš”ì²­ì— ëŒ€í•œ ì‘ë‹µì„ í•´ì¤„ ìˆ˜ ìˆë‹¤.

ì´ë²ˆì—ëŠ”, `email.js` ë¥¼ `router`ë””ë ‰í† ë¦¬ í•˜ìœ„ì— ë§Œë“¤ê³  main.jsì™€ ë¹„ìŠ·í•˜ê²Œ ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í•œë‹¤. ì´ë•Œ, ì—¬ëŸ¬ê°€ì§€ urlì„ í•˜ë‚˜ì˜ íŒŒì¼ì—ì„œ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.

```javascript
//email.js
const express = require('express');
const app = express();
const router = express.Router();
const path = require('path');

const mysql = require('mysql');
const connection = mysql.createConnection({
	host : 'localhost',
	port : 3306 , //default í¬íŠ¸
	user : 'root',
	pasword : "",
	database : 'jsman'
})
connection.connect(); // ì»¤ë„¥ì…˜ ê°ì²´ì—ì„œ connectë¼ëŠ” ë©”ì†Œë“œë¥¼ ì‹¤í–‰í•œë‹¤.

//ë¼ìš°í„°ë¥¼ ëª¨ë“ˆë¡œ exportí•œë‹¤. ë‹¤ë¥¸ íŒŒì¼ì—ì„œ ì´ ëª¨ë“ˆì„ ì½ì–´ì™€ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

router.post("/form", function(req,res){
	console.log(req.body)
	console.log(req.body.email)
	res.render("email.ejs", {"email" : req.body.email})
})

router.post("/ajax", function(req,res){
	let email = req.body.email;
	let responseData = {};
	let query = connection.query(`select name from user where email="${email}"`, function(err, rows){
		if(err) throw err;
		if(rows[0]) {
			console.log(rows)
			responseData.result = "ok";
			responseData.name = rows[0].name;
		} else {
			responseData.result = "none";
			responseData.name = "";
		}
		res.json(responseData);
	})
})

module.exports = router;
```

- `mysql`ì„ ì‚¬ìš©í•˜ë¯€ë¡œ mysqlëª¨ë“ˆì„ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ì„¤ì •ë„ ê°™ì´ í•´ì£¼ì–´ì•¼ í•œë‹¤.

app.jsì—ì„œëŠ” í•„ìš”í•œ ì½”ë“œë§Œ ë‚¨ê²¨ë‘ê³  ëª¨ë‘ ì œê±°í•´ ì¤€ë‹¤. bodyparserëŠ” app.jsì—ì„œ ì„¤ì •í•´ ì£¼ì–´ì•¼ í•œë‹¤.

```javascript
//app.js
const express = require('express');
const app = express()
const port = 3000
const bodyParser = require('body-parser');

//main.js ë¼ìš°í„° ëª¨ë“ˆ ì¶”ê°€
const main = require('./router/main')
const email = require('./router/email')

app.listen(port, function() {
	console.log("start express server on port 3000");
})

app.use(bodyParser.json())
app.use(bodyParser.urlencoded({extended:true}))
app.use(express.static("public"))
app.set('view engine', 'ejs')

// /mainìœ¼ë¡œ ë“¤ì–´ì˜¤ë©´ ë¶ˆëŸ¬ì˜¨ ë¼ìš°í„° ëª¨ë“ˆì •ë³´ë¥¼ ì‚¬ìš©í•œë‹¤.
app.use('/main', main);
// /emailë¡œ ë“¤ì–´ì˜¤ë©´ ë¶ˆëŸ¬ì˜¨ ë¼ìš°í„° ëª¨ë“ˆì •ë³´ë¥¼ ì‚¬ìš©í•œë‹¤.
app.use('/email', email);
```

- ì½”ë“œì—ì„œ ë³´ë©´ `app.use('/email', email);` ì„ ì‚¬ìš©í•˜ëŠ”ë°, `/email`ë¡œ ì‹œì‘í•˜ëŠ” ìš”ì²­ì„ ë°›ì•˜ì„ ë•Œ í•´ë‹¹ ëª¨ë“ˆì„ ì‚¬ìš©í•œë‹¤.

htmlì—ì„œë„ urlì„ ì•„ë˜ì™€ ê°™ì´ ìˆ˜ì •í•´ì¤€ë‹¤.

```html
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>email form</title>
</head>
<body>
	<form action="/email/form" method="post">
		email : <input type="text" name="email"><br/>
		<input type="submit">
	</form>
	<button class="ajaxsend">ajaxsend</button>

	<div class="result"></div>

	<script>
		document.querySelector(".ajaxsend").addEventListener('click', function(){
			const inputData = document.forms[0].elements[0].value;
			sendAjax("http://localhost:3000/email/ajax", inputData);
		})

		function sendAjax(url, data){
			const JSONdata = JSON.stringify({email : data});
			const xhr = new XMLHttpRequest();

			xhr.open('POST', url);
			xhr.setRequestHeader('content-Type', 'application/json');
			xhr.send(JSONdata);
			xhr.addEventListener('load', function(){
				console.log(xhr.responseText);
				const result  = JSON.parse(xhr.responseText);
				let resultDiv = document.querySelector(".result");
				if(result.result !== 'ok') resultDiv.innerHTML = "you email is not found";
				else resultDiv.innerHTML = result.name;
			})
		}
	</script>

</body>
</html>
```

- `<form action="/email/form" method="post">`ì™€ `sendAjax("http://localhost:3000/email/ajax", inputData);`ë¡œ url ìˆ˜ì •

## 2. Routing ë¦¬íŒ©í† ë§

`app.js` íŒŒì¼ì— `/main`ê³¼ `/email` urlì„ í° ì¤„ê¸°ë¡œ ë‚˜ëˆ„ì–´ ë¶„ë¥˜ë¥¼ í–ˆë‹¤. ì´ëŸ¬í•œ ë¼ìš°íŒ…ì„ ë³´í†µ `controller`(urlì„ íŒŒì‹±í•´ì„œ ì–´ë–¤ ì²˜ë¦¬ë¥¼ í•˜ëŠ” ê²ƒ)ë¼ê³  í•œë‹¤.

ë¼ìš°íŒ…ì„ `app.js`ì—ì„œ í†µí•©í•˜ëŠ” ê²ƒì€ ì¢‹ì€ ë°©ë²•ì´ ì•„ë‹ˆë‹¤. ë¼ìš°í„° ê´€ë¦¬ëŠ” ë¯¸ë“¤ì›¨ì–´ ê°™ì€ íŠ¹ì • íŒŒì¼ì—ì„œ ë”°ë¡œ í•˜ê³ , ê·¸ íŒŒì¼ë§Œ app.jsì—ì„œ importí•˜ëŠ” ê²ƒì´ ì¢‹ì€ ë°©ë²•ì´ë‹¤.

ê·¸ ì „ì—, `email.js`ì™€ `main.js`ë¥¼ ê°ê° router í•˜ìœ„ì— `email ë””ë ‰í† ë¦¬`ì™€ `main ë””ë ‰í† ë¦¬`ë¥¼ ë§Œë“¤ì–´ ë„£ëŠ”ë‹¤. (í•„ìˆ˜ëŠ” ì•„ë‹ˆì§€ë§Œ, ê²½ë¡œë¥¼ ê´€ë¦¬í•˜ëŠ”ë° ë””ë ‰í† ë¦¬ë³„ë¡œ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.)

```
router
â”œâ”€â”€ index.js
â”œâ”€â”€ email
â”‚   â””â”€â”€ email.js
â””â”€â”€ main
    â””â”€â”€ main.js
```

router ë””ë ‰í† ë¦¬ ì•„ë˜ì— `index.js` íŒŒì¼ì„ ë§Œë“¤ì–´ ë¼ìš°íŒ…ì„ ê´€ë¦¬(controller)í•´ë³´ê² ë‹¤.

```javascript
//index.js
const express = require('express');
const app = express();
const router = express.Router();
const path = require('path');

//ë¼ìš°í„° ëª¨ë“ˆ ì¶”ê°€
const main = require('./main/main')
const email = require('./email/email')

//ê¸°ë³¸ url ë¼ìš°íŒ…
router.get('/',(req,res)=>{
	res.sendFile(path.join(__dirname, '../public/main.html'));
})

router.use('/main', main);
router.use('/email', email);

//ë¼ìš°í„°ë¥¼ ëª¨ë“ˆë¡œ exportí•œë‹¤. ë‹¤ë¥¸ íŒŒì¼ì—ì„œ ì´ ëª¨ë“ˆì„ ì½ì–´ì™€ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
module.exports = router;
```

- `index.js`ì—ì„œ  ëª¨ë“  ë¼ìš°íŒ…ì„ ê´€ë¦¬í•˜ë„ë¡ í•´ì£¼ê³ , ë¼ìš°í„° ê°ì²´ë§Œ ëª¨ë“ˆë¡œ exportí•˜ì˜€ë‹¤.

`app.js`ëŠ” ì•„ë˜ì™€ ê°™ì´ ê°„ë‹¨í•´ì¡Œë‹¤.

```javascript
//app.js
const express = require('express');
const app = express()
const port = 3000
const bodyParser = require('body-parser');
const router = require('./router/index')

app.listen(port, function() {
	console.log("start express server on port 3000");
})

app.use(bodyParser.json())
app.use(bodyParser.urlencoded({extended:true}))
app.use(express.static("public"))
app.set('view engine', 'ejs')

//ë¼ìš°íŒ… ëª¨ë“ˆ
app.use(router);  //pathê°€ ì—†ì„ ë•ŒëŠ” path ìƒëµê°€ëŠ¥
```

ì¶”ê°€ì ìœ¼ë¡œ, htmlì„ ë‘ê°€ì§€ë¡œ ìª¼ê°œì„œ ë³€ê²½í•˜ì˜€ë‹¤.

`main.html`

```html
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>email form</title>
</head>
<body>
	<h1>ì´ˆê¸° í™”ë©´</h1>
	<a href="./main" class="">form</a>

</body>
</html>
```

`form.html`

```html
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>email form</title>
</head>
<body>
	<form action="/email/form" method="post">
		email : <input type="text" name="email"><br/>
		<input type="submit">
	</form>
	<button class="ajaxsend">ajaxsend</button>

	<div class="result"></div>

	<script>
		document.querySelector(".ajaxsend").addEventListener('click', function(){
			const inputData = document.forms[0].elements[0].value;
			sendAjax("http://localhost:3000/email/ajax", inputData);
		})

		function sendAjax(url, data){
			const JSONdata = JSON.stringify({email : data});
			const xhr = new XMLHttpRequest();

			xhr.open('POST', url);
			xhr.setRequestHeader('content-Type', 'application/json');
			xhr.send(JSONdata);
			xhr.addEventListener('load', function(){
				console.log(xhr.responseText);
				const result  = JSON.parse(xhr.responseText);
				let resultDiv = document.querySelector(".result");
				if(result.result !== 'ok') resultDiv.innerHTML = "you email is not found";
				else resultDiv.innerHTML = result.name;
			})
		}
	</script>

</body>
</html>
```

html ë¬¸ì„œ ì´ë¦„ì´ ë³€ê²½ë˜ì—ˆìœ¼ë¯€ë¡œ, `main.js`ì—ì„œ htmlê²½ë¡œì— ìˆë˜ `main.html`ì„ `form.html`ë¡œ ë°”ê¾¸ì–´ ì¤€ë‹¤.

```javascript
//main.js
const express = require('express');
//const app = express()
//express ê°ì²´ì— ìˆëŠ” Router ë©”ì†Œë“œ
const router = express.Router();

//ìƒëŒ€ê²½ë¡œ ì‚¬ìš©ì„ ìœ„í•œ path ëª¨ë“ˆ
const path = require('path');

router.get('/',(req,res)=>{
	res.sendFile(path.join(__dirname, '../public/form.html'));
})

//ë¼ìš°í„°ë¥¼ ëª¨ë“ˆë¡œ exportí•œë‹¤. ë‹¤ë¥¸ íŒŒì¼ì—ì„œ ì´ ëª¨ë“ˆì„ ì½ì–´ì™€ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
module.exports = router;
```

