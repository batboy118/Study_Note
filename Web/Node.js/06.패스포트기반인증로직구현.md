# 05. íŒ¨ìŠ¤í¬íŠ¸ê¸°ë°˜ ì¸ì¦ ë¡œì§ êµ¬í˜„

> íŒ¨ìŠ¤í¬íŠ¸ë¥¼ ê¸°ë°˜ìœ¼ë¡œí•œ íšŒì›ê°€ì…, ë¡œê·¸ì¸, ë¡œê·¸ì•„ì›ƒì˜ ë¡œì§ êµ¬í˜„ê³¼ ì¸ì¦ì²˜ë¦¬ í•™ìŠµ

[ğŸ Home](https://github.com/batboy118/Study_Note)

[â—€Previous page ](./README.md)

---

<!-- TOC -->

- 

<!-- /TOC -->

## 1.  passport í™˜ê²½êµ¬ì¶•

ë¡œê·¸ì¸ í–ˆì„ ë•Œì˜ í˜ì´ì§€ì™€ ì•„ë‹ë•Œì˜ í˜ì´ì§€ë¥¼ êµ¬ë¶„í•  í•„ìš”ê°€ ìˆìœ¼ë©°, ì„œë²„ì—ì„œëŠ” ë¡œê·¸ì¸ ìƒíƒœì— ëŒ€í•œ ìƒíƒœë¥¼ ìœ ì§€í•´ì•¼ í•œë‹¤.

ë¨¼ì €, join.html  íŒŒì¼ì„ ì‚­ì œí•˜ê³ , join.ejs íŒŒì¼ì„ views ë””ë ‰í† ë¦¬ ì•„ë˜ì— ë§Œë“¤ì–´ ì•„ë˜ ë‚´ìš©ìœ¼ë¡œ ë³€ê²½í•˜ë„ë¡ í•˜ì.

```javascript
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=<device-width>, initial-scale=1.0">
	<title>Join !</title>
	<style>
		.message{
			color : #963b3b;
			margin-bottom : 16px;
		}
	</style>
</head>
<body>
	<h1>join my website!</h1>
	<section class="message"><=% message %></section>
	<form action="/join" method="post">
		email : <input type="text" name="email"><br>
		name : <input type="text" name="name"><br>
		password : <input type="text" name="password"><br>
		<input type="submit">
	</form>
</body>
</html>
```

join/index.js íŒŒì¼ë„ ì•„ë˜ì™€ ê°™ì´ ìˆ˜ì •í•œë‹¤.

```javascript
//join/index.js
const express = require('express');
const app = express();
const router = express.Router();
const path = require('path');

const mysql = require('mysql');
const connection = mysql.createConnection({
	host : 'localhost',
	port : 3306 , //default í¬íŠ¸
	user : 'root',
	pasword : "",
	database : 'jsman'
})
connection.connect(); // ì»¤ë„¥ì…˜ ê°ì²´ì—ì„œ connectë¼ëŠ” ë©”ì†Œë“œë¥¼ ì‹¤í–‰í•œë‹¤.

//ë¼ìš°í„°ë¥¼ ëª¨ë“ˆë¡œ exportí•œë‹¤. ë‹¤ë¥¸ íŒŒì¼ì—ì„œ ì´ ëª¨ë“ˆì„ ì½ì–´ì™€ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

//get
router.get("/", function(req,res){
	console.log("get join url")
	res.render('join.ejs',{message:''})
})

//post
router.post("/", function(req,res){
	let body = req.body;
	let userInfo = {
		email : body.email,
		name : body.name,
		pw : body.password
	}
	console.log(userInfo)
	let query = connection.query(`insert into user set ?`, userInfo, function(err,rows){
		if(err) throw err;
		else res.render('welcome.ejs', {'name' : userInfo.name, 'id' : rows.insertId});
		console.log("OK : " , rows, rows.insertId, userInfo);
	})
})

module.exports = router;
```

ì´ì œ passportë¥¼ ì„¤ì¹˜í•´ë³´ì.

`npm install passport passport-local express-session connect-flash --save-dev`

- passport : ì¸ì¦ ê´€ë ¨ ëª¨ë“ˆ
- passport-local : ì¼ë°˜ì ì¸ ë¡œê·¸ì¸ ì²˜ë¦¬ë¥¼ ìœ„í•œ ëª¨ë“ˆ (ë¡œê·¸ì¸ ì •ë³´ë¥¼ ë¡œì»¬ DBì— ì €ì¥)
- express-session : ì„¸ì…˜ ê´€ë¦¬ ì²˜ë¦¬
- connect-flash : ì—ëŸ¬ë©”ì‹œì§€ ë“±ì„ ë¦¬ë‹¤ì´ë ‰íŠ¸ í•´ì£¼ëŠ” ê²ƒì„ ë„ì™€ì£¼ëŠ” ëª¨ë“ˆ

 ì„¤ì¹˜ê°€ ëë‚¬ë‹¤ë©´, app.jsì—ì„œ ëª¨ë“ˆì„ ì¶”ê°€í•´ì¤€ë‹¤.

```javascript
//app.js
const express = require('express');
const app = express()
const port = 3000
const bodyParser = require('body-parser');
const router = require('./router/index');
const passport = require('passport');
const LocalStrategy = require('passport-local').Strategy;
const session = require('express-session');
const flash = require('connect-flash');

app.listen(port, function() {
	console.log("start express server on port 3000");
})

app.use(bodyParser.json())
app.use(bodyParser.urlencoded({extended:true}))
app.use(express.static("public"))
app.set('view engine', 'ejs')

//ë¼ìš°íŒ… ëª¨ë“ˆ
app.use(router);  //pathê°€ ì—†ì„ ë•ŒëŠ” path ìƒëµê°€ëŠ¥
```

