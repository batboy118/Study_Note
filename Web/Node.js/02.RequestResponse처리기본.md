#  02. Request,Response ì²˜ë¦¬ ê¸°ë³¸

>Request,Response ì²˜ë¦¬ ê¸°ë³¸

[ğŸ Home](https://github.com/batboy118/Study_Note)

[â—€Previous page ](./README.md)

---

<!-- TOC -->

- [1. POST ìš”ì²­ì²˜ë¦¬](#1-post-ìš”ì²­ì²˜ë¦¬)
- [2. View engineì„ í™œìš©í•œ ì‘ë‹µì²˜ë¦¬](#2-view-engineì„-í™œìš©í•œ-ì‘ë‹µì²˜ë¦¬)
- [3. JSON í™œìš©í•œ Ajaxì²˜ë¦¬](#3-json-í™œìš©í•œ-ajaxì²˜ë¦¬)

<!-- /TOC -->

## 1. POST ìš”ì²­ì²˜ë¦¬

```html
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>email form</title>
</head>
<body>
	<form action="/email_post" method="post">
		email : <input type="text" name="email"><br/>
		<input type="submit">
	</form>

</body>
</html>
```

- formíƒœê·¸ë¥¼ ì´ìš©í•˜ì—¬ ì„œë²„ì— ìš”ì²­ì„ í•  ìˆ˜ ìˆë‹¤.
- `<form action="/email_post" method="post"></form>`
  - action : ì„œë²„ì—ì„œ ì–´ë””ë¡œ ê°ˆ ê²ƒì¸ì§€
  - method : ì–´ë–¤ ìš”ì²­ì„ í•  ê²ƒì¸ì§€
    - get ë©”ì†Œë“œëŠ” URLì„ ê¸°ë°˜ìœ¼ë¡œ ì–´ë– í•œ íŒŒì¼(ê¸°ë³¸ì ìœ¼ë¡œëŠ” í˜ì´ì§€)ì„ ìš”ì²­í•˜ëŠ” ê²ƒì´ë‹¤. í˜ì´ì§€ ë‚´ì˜ ì •ì  íŒŒì¼ì„ ìš”ì²­í•  ë•ŒëŠ” `URL`ê³¼ `?` ì™€ `key`ë¥¼ í•¨ê»˜ ë³´ë‚´ì–´ íŠ¹ì • íŒŒì¼ì„ ìš”ì²­í•œë‹¤. getì€ ë°ì´í„°ë¥¼ ë³´ë‚¼ë•Œ URLì„ ì´ìš©í•˜ê¸° ë•Œë¬¸ì— ë°ì´í„°(=URL)ì˜ ê¸¸ì´ ì œí•œ ë“±ì´ ì¡´ì¬í•œë‹¤. ë˜í•œ, ì¤‘ìš”í•œ ì •ë³´ë¥¼ getìœ¼ë¡œ ìš”ì²­í•˜ê²Œ ë˜ë©´ ì •ë³´ê°€ urlë¡œ ë…¸ì¶œë  ìˆ˜ ìˆë‹¤.
    - post ë©”ì†Œë“œëŠ” URLì„ ì´ìš©í•œ ë°©ì‹ì´ ì•„ë‹ˆë‹¤. ì„œë²„ë¡œ ë°ì´í„°ë¥¼ ë³´ë‚¼ ë•ŒëŠ” post ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

- ì´ì „ì— ì‘ì„±ëë˜ ì½”ë“œì—ì„œ `main.html`ì„ ìœ„ ì½”ë“œë¡œ ìˆ˜ì •í•˜ê³  ì„œë²„ë¥¼ ì‘ë™ì‹œì¼œë³¸ ë’¤ ì´ë©”ì¼ì„ ì…ë ¥í•˜ê³  ì œì¶œì„ ëˆŒëŸ¬ë³´ë©´ `Cannot POST /email_post` ì˜¤ë¥˜ê°€ ë‚  ê²ƒì´ë‹¤. ì´ëŠ” ì•„ì§, ì„œë²„ì—ì„œ `/email_post`ë¶€ë¶„ì— ëŒ€í•´ ë¼ìš°íŒ… ì²˜ë¦¬ë¥¼ í•´ì£¼ì§€ ì•Šì•„ì„œ ìƒê¸°ëŠ” ë¬¸ì œì´ë‹¤. ì•„ë˜ì™€ ê°™ì´ app.jsì— `post` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¼ìš°íŒ… ì²˜ë¦¬ë¥¼ í•´ì£¼ë©´ ëœë‹¤.

```javascript
//app.js
const express = require('express');
const app = express()
const port = 3000

app.listen(port, function() {
	console.log("start express server on port 3000");
})

app.get('/',(req,res)=>{
	res.sendFile(__dirname + '/public/main.html');
})

app.use(express.static("public"))

app.post("/email_post", function(req,res){
	res.send("post response")
})
```

- ì´ë ‡ê²Œ í•œ í›„ ì´ë©”ì¼ì„ ì ì–´ ì œì¶œí•˜ë©´ `post response`ë¼ëŠ” ê¸€ìê°€ ì°íŒ í™”ë©´ì´ ë‚˜ì˜¬ ê²ƒì´ë‹¤. ì¦‰, ì œì¶œë²„íŠ¼ì„ ëˆ„ë¥´ë©´ `/email_post`URLê³¼ í•¨ê»˜ POST ë©”ì„œë“œë¥¼ ì„œë²„ë¡œ ë³´ë‚´ê²Œ ë˜ê³ , ì„œë²„ì—ì„œëŠ” ê·¸ì— ë§ëŠ” ê²°ê³¼ë¥¼ ë³´ë‚´ì£¼ê³  ì‘ì—…ì„ ì²˜ë¦¬í•œë‹¤. ìœ„ ì½”ë“œì—ì„œëŠ” í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì œì¶œë²„íŠ¼ì„ ëˆ„ë¥´ë©´ `/email_post`ì— ëŒ€í•œ url ìš”ì²­ê³¼ í•¨ê»˜ POST ë©”ì†Œë“œë¥¼ ë³´ë‚´ê²Œ ë˜ê³ , ì„œë²„ëŠ” ê·¸ì— ëŒ€í•´ `post response`ë¼ëŠ” í˜ì´ì§€ë¥¼ ë³´ì—¬ì£¼ëŠ” ê²ƒì´ë‹¤.

í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë³´ë‚¸ ì´ë©”ì¼ ì£¼ì†ŒëŠ” ì„œë²„ì—ì„œ ì–´ë–»ê²Œ ë°›ì„ ìˆ˜ ìˆì„ê¹Œ?

get ë©”ì„œë“œë¼ë©´, `req.param('email')`í•¨ìˆ˜ë¥¼ ì¨ì„œ íŠ¹ì • íŒŒë¼ë¯¸í„°ë¥¼ URLì—ì„œ ë°›ì•„ ì˜¬ ìˆ˜ìˆì§€ë§Œ, postëŠ” ë‹¤ë¥¸ ë°©ì‹ì„ ì´ìš©í•´ì•¼ í•œë‹¤. postëŠ” `body Parser`ë¼ëŠ” ë³„ë„ì˜ ëª¨ë“ˆì„ ì‚¬ìš©í•´ì•¼ ë°ì´í„°ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

body parser ì„¤ì¹˜ : `npm install body-parser --save`

```javascript
//app.js
const express = require('express');
const app = express()
const port = 3000
const bodyParser = require('body-parser');

app.use(express.static("public"))
app.use(bodyParser.json())
app.use(bodyParser.urlencoded({extended:true}))

app.listen(port, function() {
	console.log("start express server on port 3000");
})

app.get('/',(req,res)=>{
	res.sendFile(__dirname + '/public/main.html');
})

app.post("/email_post", function(req,res){
	console.log(req.body)
	console.log(req.body.email)
    res.send(`<h1>Welcome ${req.body.email} </h1>`)
})
```

- `const bodyParser = require('body-parser');` : body-parserë¥¼ ì„¤ì¹˜í–ˆê¸° ë•Œë¬¸ì— í•´ë‹¹ ëª¨ë“ˆì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ requireí•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ body-parser ê°ì²´ë¥¼ ë¶ˆëŸ¬ì˜¨ë‹¤.

- ë°”ë””íŒŒì„œë¥¼ ì´ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ë°”ë””íŒŒì„œë¥¼ ì´ìš©í•œë‹¤ëŠ” ê²ƒì„ expressì—ê²Œ ì•Œë ¤ì£¼ì–´ì•¼ í•œë‹¤.`app.use(bodyParser.json())` & `app.use(bodyParser.urlencoded({extended:true}))`

  í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì˜¤ëŠ” ë°ì´í„°ê°€ `json`í˜•ì‹ì¼ ìˆ˜ë„ ìˆê³ , jsonì´ ì•„ë‹Œí˜•íƒœë¡œ `ì¸ì½”ë”©ëœ í˜•íƒœ`ë¡œ ì˜¬ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ë‘ê°€ì§€ì˜ ê²½ìš°ì— ëŒ€í•´ì„œ use ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•´ ì£¼ì—ˆë‹¤.

- `console.log(req.body)`ë¥¼ ì°ì–´ë³´ë©´, Objectí˜•ì‹ìœ¼ë¡œ bodyê°€ íŒŒì‹±ëœ ê²ƒì„ ë³¼ ìˆ˜ ìˆê³ , `console.log(req.body.email)`ë©´ Object ë‚´ë¶€ì˜ emailì— í•´ë‹¹í•˜ëŠ” keyì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.
-  `res.send(``<h1>Welcome ${req.body.email} </h1>``)` ì„ ì´ìš©í•˜ì—¬ ë°”ë¡œ ë°›ì€ ë°ì´í„°ë¥¼ í™œìš©í•˜ì—¬ ìœ ì €ì—ê²Œ ì‘ë‹µí• ìˆ˜ë„ ìˆë‹¤.

## 2. View engineì„ í™œìš©í•œ ì‘ë‹µì²˜ë¦¬

[Express View engine](https://expressjs.com/en/resources/template-engines.html) ì—ëŠ” ì—¬ëŸ¬ê°€ì§€ê°€ ì¡´ì¬ í•œë‹¤. ê·¸ ì¤‘ì— ejs ì—”ì§„ì„  ì‚¬ìš©í•  ê²ƒì´ë‹¤.

EJS ë·° í…œí”Œë¦¿ì„ ì´ìš©í•˜ì—¬ expressì—ì„œ HTML ì‘ë‹µì„ ì¤„ ë•Œ ë°ì´í„°ì™€ HTMLì„ ì–´ë–»ê²Œ ê²°í•©í•´ì„œ ì „ë‹¬í• ì§€ ì •í•´ì¤„ ìˆ˜ ìˆë‹¤.

EJS ëª¨ë“ˆ ì„¤ì¹˜ : `npm install ejs --save`

```javascript
//app.js
const express = require('express');
const app = express()
const port = 3000
const bodyParser = require('body-parser');

app.listen(port, function() {
	console.log("start express server on port 3000");
})

app.use(express.static("public"))
app.use(bodyParser.json())
app.use(bodyParser.urlencoded({extended:true}))

//URL ë¼ìš°íŒ…
app.get('/',(req,res)=>{
	res.sendFile(__dirname + '/public/main.html');
})

app.post("/email_post", function(req,res){
	console.log(req.body)
	console.log(req.body.email)
	//res.send(`<h1>Welcome ${req.body.email} </h1>`)
	res.render("email.ejs", {"email" : req.body.email})
})

```

- `app.set('view engine', 'ejs')` : view ì—”ì§„ì„ ejsë¡œ ì„¤ì •í•œë‹¤.
- `res.send`ëŒ€ì‹  `res.render`ë©”ì†Œë“œë¥¼ ì´ìš©í•˜ì—¬ `ejs`í…œí”Œë¦¿ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
  - `res.render("email.ejs", {"email" : req.body.email})`
    - email.ejs ë¥¼ ì‘ë‹µí•˜ê³ , `email`ì´ë¼ëŠ” keyê°’ì— `req.body.email`ë§¤í•‘ì‹œì¼œì„œ email.ejsì—ì„œ `email`ì´ë¼ëŠ” ê°’ì„ ì‚¬ìš©í•˜ë©´ í•´ë‹¹ ê°’ì„ `req.body.email`ë¡œ ëŒ€ì¹˜í•˜ì—¬ ì‘ë‹µí•œë‹¤.
- ë·°ëŠ” ì§€ì •ëœ ë””ë ‰í† ë¦¬ê°€ ì¡´ì¬í•œë‹¤. í”„ë¡œì íŠ¸ ìµœìƒìœ„ ë””ë ‰í† ë¦¬ì— `views`ë¼ëŠ” ë””ë ‰í† ë¦¬ë¥¼ ìƒì„±í•˜ê³ , `email.ejs`ë¼ëŠ” ë·°ë¥¼ ë§Œë“¤ê³  ì•„ë˜ ë‚´ìš©ì„ ë„£ëŠ”ë‹¤.

```ejs
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>email ejs template</title>
</head>
<body>

	<h1>Welcome !! <%=email %> </h1>
	<p>ë°˜ê°‘ìŠµë‹ˆë‹¤.</p>

</body>
</html>
```

-  `<%=email %>`ì™€ ê°™ì€ í˜•íƒœë¡œ íŠ¹ì • ë°ì´í„°ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

## 3. JSON í™œìš©í•œ Ajaxì²˜ë¦¬

```html
<form action="/email_post" method="post">
    email : <input type="text" name="email"><br/>
    <input type="submit">
</form>
```

ê¸°ì¡´ì—ëŠ” ì´ëŸ¬í•œ í˜•íƒœë¡œ, `ì œì¶œ`ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ formì„ í™•ì¸í•´ì„œ `action`ì— í•´ë‹¹í•˜ëŠ” URL( `/email_post`)ê³¼ í•¨ê»˜ ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ë„ë¡ ë˜ì–´ ìˆì—ˆë‹¤. ì¦‰, ì œì¶œ í›„ì— `/email_post`ë¡œ URLì´ ë³€ê²½ë˜ë©´ì„œ reload ê³¼ì •ì´ í•„ì—°ì ìœ¼ë¡œ ë°œìƒí–ˆë‹¤.

í•˜ì§€ë§Œ,  Ajaxì²˜ë¦¬ë¥¼ ì´ìš©í•˜ì—¬ **ë¸Œë¼ìš°ì €ì˜ ìƒˆë¡œê³ ì¹¨(Reload) ì—†ì´** HTTP requestë¡œ ì„œë²„ì— ë°ì´í„°ë¥¼ ë³´ë‚´ê³ , ì„œë²„ì—ì„œ ë°›ì€ ë°ì´í„°ë¥¼ í™•ì¸í•˜ê³  ì²˜ë¦¬ í›„ ì‘ë‹µì„ ì¤„ ìˆ˜ ìˆë‹¤. ì´ë²ˆì—ëŠ” `JSON`í˜•íƒœì˜ ë°ì´í„°ë¥¼ ì´ìš©í•˜ì—¬ ìš”ì²­ê³¼ ì‘ë‹µì„ í•´ë³´ë„ë¡ í•˜ê² ë‹¤.

```javascript
//app.js
const express = require('express');
const app = express()
const port = 3000
const bodyParser = require('body-parser');

app.listen(port, function() {
	console.log("start express server on port 3000");
})

app.use(express.static("public"))
app.use(bodyParser.json())
app.use(bodyParser.urlencoded({extended:true}))

//URL ë¼ìš°íŒ…
app.get('/',(req,res)=>{
	res.sendFile(__dirname + '/public/main.html');
})

app.post("/email_post", function(req,res){
	console.log(req.body)
	console.log(req.body.email)
	//res.send(`<h1>Welcome ${req.body.email} </h1>`)
	res.render("email.ejs", {"email" : req.body.email})
})

// â˜…ì¶”ê°€ëœ ë¶€ë¶„â˜…
app.post("/ajax_send_email", function(req,res){
	console.log(req.body.email)
	//ì„œë²„ì—ì„œëŠ” ìŠ¤íŠ¸ë§ ì²˜ë¦¬ë¥¼ ì•ˆí•´ë„ json()ë©”ì†Œë“œë¥¼ í†µí•´ ìë™ìœ¼ë¡œ ìŠ¤íŠ¸ë§ ë³€í™˜ëœë‹¤.
	const resposeData = {result : 'ok', 'email' : req.body.email}
	res.json(resposeData)
})
```

`/ajax_send_email` urlì„ í†µí•´ ìš”ì²­ì´ ì˜¤ë©´, JSONí˜•íƒœì˜ ë°ì´í„°ë¥¼ ìƒì„±í•˜ì—¬, jsoní˜•íƒœì˜ ë°ì´í„°ë¡œ ì‘ë‹µ

```html
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>email form</title>
</head>
<body>
	<form action="/email_post" method="post">
		email : <input type="text" name="email"><br/>
		<input type="submit">
	</form>
	<button class="ajaxsend">ajaxsend</button>

	<div class="result"></div>

	<script>
		document.querySelector(".ajaxsend").addEventListener('click', function(){
			//formsë¥¼ ì´ìš©í•˜ì—¬ ë¦¬ìŠ¤íŠ¸ ì²˜ëŸ¼ form íƒœê·¸ì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤. (elemnets ë„ ë§ˆì°¬ê°€ì§€)
			//ì•„ë˜ëŠ” form íƒœê·¸ì¤‘ 1ë²ˆì§¸ íƒœê·¸ì—ì„œ 1ë²ˆì§¸ elemnet (=<input type="text" name="email"><br/>) ì˜ ì…ë ¥ ê°’ì— ì ‘ê·¼
			const inputData = document.forms[0].elements[0].value;
			//sendAjax("http://127.0.0.1:3000/ajax_send_email", inputData);
			sendAjax("http://localhost:3000/ajax_send_email", inputData);
		})

		function sendAjax(url, data){
			//JSON í˜•íƒœë¡œ dataë¥¼ ìƒì„±í•œë‹¤. dataëŠ” ìŠ¤íŠ¸ë§ í˜•íƒœë¡œ ì „ë‹¬í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— JSON.stringify ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•œë‹¤.
			const JSONdata = JSON.stringify({email : data});
			const xhr = new XMLHttpRequest();

			//openì€ ì²«ë²ˆì§¸ ì¸ìë¡œ ë©”ì†Œë“œë¥¼ ì¨ì£¼ê³ , ë‘ë²ˆì§¸ ì¸ìë¡œ urlì„ ë„£ì–´ì¤€ë‹¤.
			xhr.open('POST', url);
			//setRequestHeaderë¥¼ ì´ìš©í•˜ì—¬ content-Typeì„ jsonìœ¼ë¡œ ì„¤ì •í•´ ì¤€ë‹¤.
			xhr.setRequestHeader('content-Type', 'application/json');
			//sendì— dataë¥¼ ë„£ì–´ì¤€ë‹¤.
			xhr.send(JSONdata);
			//ì„œë²„ë¡œ ë¶€í„° ì‘ë‹µì´ ì œëŒ€ë¡œ ëì„ ë•Œ, ì½œë°±í•¨ìˆ˜ë¥¼ ì‹¤í–‰
			xhr.addEventListener('load', function(){
				//ì‘ë‹µë°›ì€ textë¥¼ ì½˜ì†”ì— ì¶œë ¥
				console.log(xhr.responseText);
				//ìŠ¤í‹°ë§ í˜•íƒœì˜ ë°ì´í„° ì´ë¯€ë¡œ, parseë¥¼ í•´ì£¼ì–´ ê°ì²´ë¡œ ë³€ê²½í•´ì•¼ í•œë‹¤.
				const result  = JSON.parse(xhr.responseText);
				//resultì˜ innerHTMLì— emailì„ ë„£ì–´ì¤Œ
				document.querySelector(".result").innerHTML = result.email;
			})
		}
	</script>

</body>
</html>
```

`ajaxsend` ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì…ë ¥ì°½ì˜ ê°’ì„ `http://localhost:3000/ajax_send_email`ë¡œ json í˜•íƒœì˜ ìŠ¤íŠ¸ë§ ë°ì´í„°ë¡œ ë³€í™˜í•˜ì—¬ ì „ë‹¬í•˜ê³ , ì„œë²„ì—ì„œ ë°›ì€ jsoní˜•íƒœì˜ ìŠ¤íŠ¸ë§ ë°ì´í„°ë¥¼ íŒŒì‹±í•˜ì—¬ í˜ì´ì§€ì˜ reload ì—†ì´ `document.querySelector(".result").innerHTML = result.email;`ì„ ì´ìš©í•˜ì—¬ í˜ì´ì§€ì˜ íŠ¹ì •ë¶€ë¶„ì— emailì„ ì¶œë ¥í•˜ê²Œ í•´ì£¼ì—ˆë‹¤.