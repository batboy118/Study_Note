# 05. DB ë°ì´í„°ì¶”ê°€

> í´ë¼ì´ì–¸íŠ¸ë¡œ ë¶€í„° ì˜¤ëŠ” ë°ì´í„°ë¥¼  DBì— ì¶”ê°€ (ex, post/íšŒì›ê°€ì…)

[ğŸ Home](https://github.com/batboy118/Study_Note)

[â—€Previous page ](./README.md)

---

<!-- TOC -->

- [1. DBì— ë°ì´í„°ì¶”ê°€ (create user)](#1-dbì—-ë°ì´í„°ì¶”ê°€-create-user)

<!-- /TOC -->

## 1.  DBì— ë°ì´í„°ì¶”ê°€ (create user)

ë°ì´í„°ë² ì´ìŠ¤ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ `CRUD` (Create, Read, Update, Delete) ê¸°ëŠ¥ì´ ìˆìœ¼ë©°, ë³´í†µ http ë©”ì†Œë“œì™€ ë§¤ì¹­ë˜ì–´ ë™ì‘í•œë‹¤. ì´ë²ˆì—ëŠ” CURD ì¤‘ Createì— ëŒ€í•´ì„œ í•™ìŠµí•˜ê² ë‹¤.

ë¼ìš°í„°ë¥¼ ê´€ë¦¬í•˜ëŠ” `index.js`ì—ì„œ `/join`ì´ë¼ëŠ”  urlì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì„¤ì •ì„ í•´ì¤€ë‹¤.

```javascript
//index.js
const express = require('express');
const app = express();
const router = express.Router();
const path = require('path');

//ë¼ìš°í„° ëª¨ë“ˆ ì¶”ê°€
const main = require('./main/main')
const email = require('./email/email')
const join = require('./join/index')

//ê¸°ë³¸ url ë¼ìš°íŒ…
router.get('/',(req,res)=>{
	res.sendFile(path.join(__dirname, '../public/main.html'));
})

router.use('/main', main);
router.use('/email', email);
router.use('/join', join);

//ë¼ìš°í„°ë¥¼ ëª¨ë“ˆë¡œ exportí•œë‹¤. ë‹¤ë¥¸ íŒŒì¼ì—ì„œ ì´ ëª¨ë“ˆì„ ì½ì–´ì™€ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
module.exports = router;
```

`join/index.js`ëŠ” ì•„ë˜ì™€ ê°™ì´ ì„¤ì •í•´ ì¤€ë‹¤.

```javascript
//join/index.js
const express = require('express');
const app = express();
const router = express.Router();
const path = require('path');

const mysql = require('mysql');
const connection = mysql.createConnection({
	host : 'localhost',
	port : 3306 , //default í¬íŠ¸
	user : 'root',
	pasword : "",
	database : 'jsman'
})
connection.connect(); // ì»¤ë„¥ì…˜ ê°ì²´ì—ì„œ connectë¼ëŠ” ë©”ì†Œë“œë¥¼ ì‹¤í–‰í•œë‹¤.

//ë¼ìš°í„°ë¥¼ ëª¨ë“ˆë¡œ exportí•œë‹¤. ë‹¤ë¥¸ íŒŒì¼ì—ì„œ ì´ ëª¨ë“ˆì„ ì½ì–´ì™€ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

router.get("/", function(req,res){
	res.sendFile(path.join(__dirname, '../../public/join.html'))
})

module.exports = router;
```

- `ì£¼ì†Œ/join`ìœ¼ë¡œ ì™”ì„ë•Œ ì •ì íŒŒì¼ì¸ htmlì„ ì „ë‹¬í•´ì¤€ë‹¤.

`public`ë””ë ‰í† ë¦¬ì—  `join.html`ë„ ìƒì„±í•´ì¤€ë‹¤.

```javascript
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=<device-width>, initial-scale=1.0">
	<title>Document</title>
</head>
<body>
	<h1>join my website</h1>
	<form action="/join" method="post">
		email : <input type="text" name="email"><br>
		name : <input type="text" name="name"><br>
		password : <input type="text" name="password"><br>
		<input type="submit">
	</form>
</body>
</html>
```

-  formíƒœê·¸ì˜  actionì„ ë³´ë©´ `/join`ì¸ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ì´ëŠ” í˜„ì¬ ì°½ì˜ urlê³¼ ê°™ë‹¤. í•˜ì§€ë§Œ, í˜„ì¬ì°½ì„ ì½ì–´ ì˜¤ëŠ” ë©”ì†Œë“œëŠ” getì´ì§€ë§Œ formì— í•´ë‹¹í•˜ëŠ” ë©”ì†Œë“œëŠ” postì´ë‹¤. ì¦‰, ê°™ì€ urlì´ë¼ê³  í•˜ë”ë¼ë„ ë©”ì†Œë“œì— ë”°ë¼ ë‹¤ë¥´ê²Œ ë¼ìš°íŒ…ì„ í•´ì¤„ìˆ˜ ìˆë‹¤.

ì•„ë˜ì™€ ê°™ì´ postì— ëŒ€í•œ ë¼ìš°íŒ…ë„ ì„¤ì •ì„ ì¶”ê°€í•œë‹¤.

```javascript
//post
router.post("/", function(req,res){
	let body = req.body;
	let userInfo = {
		email : body.email,
		name : body.name,
		password : body.password
	}
	console.log(userInfo)
})
```

- postì— ëŒ€í•œ ë¼ìš°íŒ…ì„ ì¶”ê°€ : ë°›ì•„ì˜¨ ë°ì´í„°ë¥¼ userInfoì— ë„£ì–´ consoleì— ì¶œë ¥

ì´ì œ ë°›ì•„ì˜¨ ë°ì´í„°ë¥¼ ì¿¼ë¦¬ë¬¸ì„ ì´ìš©í•˜ì—¬ DBì— ì¶”ê°€í•˜ëŠ” ì‘ì—…ì„ í•´ë³´ê² ë‹¤.

```javascript
router.post("/", function(req,res){
	let body = req.body;
	let userInfo = {
		email : body.email,
		name : body.name,
		pw : body.password
	}
	console.log(userInfo)
	let query = connection.query(`insert into user set ?`, userInfo, function(err,rows){
		if(err) throw err;
		else res.render('welcome.ejs', {'name' : userInfo.name, 'id' : rows.insertId});
		console.log("OK : " , rows.insertId, userInfo);
	})
})
```

- ì¿¼ë¦¬ë¬¸ì„ í†µí•´ dbì— ë°ì´í„°ë¥¼ ì¶”ê°€í•˜ì˜€ë‹¤.
- `welcone.ejs`ì„ ë Œë”ë§

ì´ì œ DBì— ì¶”ê°€ëœ ë°ì´í„°ë¥¼ ì´ìš©í•˜ì—¬ HTMLí˜ì´ì§€ë¥¼ í†µí•œ ì‘ë‹µì„ í•´ë³´ë„ë¡ í•˜ê² ë‹¤. `view`ì— `welcone.ejs`íŒŒì¼ì„ ìƒì„±í•˜ë„ë¡ í•œë‹¤.

```ejs
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Welcome!ğŸ‰</title>
</head>
<body>

	<h1>Welcome !! <%= name %> </h1>
	<p><%= id %> ë²ˆì§¸ ê°€ì…ì ì…ë‹ˆë‹¤! ì¶•í•˜ë“œë ¤ìš”.ğŸ˜€</p>

</body>
</html>
```



