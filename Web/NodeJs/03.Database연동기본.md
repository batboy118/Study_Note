# 03. Database ì—°ë™ ê¸°ë³¸

>Database ì—°ë™ ê¸°ë³¸

[ğŸ Home](https://github.com/batboy118/Study_Note)

[â—€Previous page ](./README.md)

---

<!-- TOC -->

- [1. MySQL ì—°ë™ ì„¤ì •](#1-mysql-ì—°ë™-ì„¤ì •)
- [2. MySQL ì—°ë™ êµ¬í˜„](#2-mysql-ì—°ë™-êµ¬í˜„)

<!-- /TOC -->

## 1.  MySQL ì—°ë™ ì„¤ì •

expressì™€ mysqlì„ ì—°ë™í•˜ì—¬, ì„œë²„ì—ì„œ ìš”ì²­ê°’ì„ ë°›ì•„ ë°ì´í„° ë² ì´ìŠ¤ì—ì„œ í•´ë‹¹ ìš”ì²­ì— ë§ëŠ” ë°ì´í„°ë¥¼ ì°¾ì•„ ë°˜í™˜í•˜ëŠ” ì‹­ìŠµì„ ì§„í–‰í•  ê²ƒì´ë‹¤.

ë¡œì»¬ì— mysql ì„œë²„ê°€ ê¹”ë ¤ìˆë‹¤ê³  ê°€ì •í•˜ê³  ì§„í–‰(ì—†ìœ¼ë©´, ì„¤ì¹˜í•´ì•¼í•¨)

`mysql -u root -p`ë¡œ mysqlì— ì ‘ì†í•œë‹¤.

```mysql
create database jsman;
use jsman;
create table user(
    uid int NOT NULL AUTO_INCREMENT PRIMARY KEY,
	email char(30),
    name char(10),
    pw char(20)
);
show tables;
insert into user (email,name,pw) values ('crong@naver.com', 'crong', 'qlalfqjsgh');
select * from user;
```

- jsmanì´ë¼ëŠ” ë°ì´í„° ë² ì´ìŠ¤ë¥¼ ìƒì„±í•˜ê³  jsmanë°ì´í„° ë² ì´ìŠ¤ë¡œ ë³€ê²½í•œë‹¤.
- `email, name, pw`columì„ ê°€ì§€ëŠ” `user`ë¼ëŠ” í…Œì´ë¸”ì„ ìƒì„±í•œë‹¤.
- í…Œì´ë¸”ì— ë°ì´í„°ë¥¼ ë„£ì–´ì¤€ë‹¤.

ë¡œì»¬ì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ìƒì„±í–ˆë‹¤ë©´, í”„ë¡œì íŠ¸ì— mysql ëª¨ë“ˆì„ ì„¤ì¹˜í•´ì•¼ í•œë‹¤.

`npm install mysql --save`

```javascript
//app.js
const express = require('express');
const app = express()
const port = 3000
const bodyParser = require('body-parser');
const mysql = require('mysql');

const connection = mysql.createConnection({
	host : 'localhost',
	port : 3306 , //default í¬íŠ¸
	user : 'root',
	pasword : "",
	database : 'jsman'
})

connection.connect(); // ì»¤ë„¥ì…˜ ê°ì²´ì—ì„œ connectë¼ëŠ” ë©”ì†Œë“œë¥¼ ì‹¤í–‰í•œë‹¤.

app.listen(port, function() {
	console.log("start express server on port 3000");
})

app.use(express.static("public"))
app.use(bodyParser.json())
app.use(bodyParser.urlencoded({extended:true}))
app.set('view engine', 'ejs')

//URL ë¼ìš°íŒ…
app.get('/',(req,res)=>{
	res.sendFile(__dirname + '/public/main.html');
})

app.post("/email_post", function(req,res){
	console.log(req.body)
	console.log(req.body.email)
	res.render("email.ejs", {"email" : req.body.email})
})

app.post("/ajax_send_email", function(req,res){
	console.log(req.body.email)
	const resposeData = {result : 'ok', 'email' : req.body.email}
	res.json(resposeData)
})
```

- [express  ë°ì´í„°ë² ì´ìŠ¤ í†µí•©](https://expressjs.com/ko/guide/database-integration.html)
- `const mysql = require('mysql');`  ë¡œ msql ê°ì²´ ìƒì„±
- `const connection = mysql.createConnection` ë°ì´í„° ë² ì´ìŠ¤ ì •ë³´ë¥¼ ë‹´ì€ connetion ê°ì²´ ìƒì„±
- `connection.connect();` : ë°ì´í„° ë² ì´ìŠ¤ ì—°ê²°

## 2. MySQL ì—°ë™ êµ¬í˜„

ìœ„ ì½”ë“œ ì¤‘ ê°€ì¥ ë§ˆì§€ë§‰ ë¼ìš°íŒ…ì— í•´ë‹¹í•˜ëŠ” `app.post("/ajax_send_email", function(req,res)` ë¶€ë¶„ì„ ìˆ˜ì •í•˜ì—¬ Databaseì—ì„œ ê°’ì„ ì°¾ì•„ ì „ë‹¬í•´ì£¼ë„ë¡ ë§Œë“¤ì–´ë³´ì.

```javascript
app.post("/ajax_send_email", function(req,res){
	let email = req.body.email;
	let responseData = {};
	let query = connection.query(`select name from user where email="${email}"`, function(err, rows){
		if(err) throw err;
		if(rows[0]) {
			responseData.result = "ok";
			responseData.name = rows[0].name;
		} else {
			responseData.result = "none";
			responseData.name = "";
		}
		res.json(responseData);
	})
})
```

- responseDataë¼ëŠ” objë¥¼ ë§Œë“ ë‹¤.
- `connection.query` ë©”ì†Œë“œë¥¼ í†µí•´ ì—°ê²°ëœ ë°ì´í„° ë² ì´ìŠ¤ì—ì„œ `select name from user where email="${email}"` ëª…ë ¹ì–´ë¡œ í…Œì´ë¸”ì—ì„œ emailì— í•´ë‹¹í•˜ëŠ” nameì„ ë¶ˆëŸ¬ì™€ì„œ ê·¸ ê²°ê³¼ë¥¼ ì½œë°±í•¨ìˆ˜ì˜ ì¸ìë¡œ ì „ë‹¬í•´ ì¤€ë‹¤. ì´ë•Œ, ì—ëŸ¬ê°€ ë°œìƒí–ˆë‹¤ë©´ ì½œë°±í•¨ìˆ˜ì˜ ì²« ë²ˆì§¸ íŒŒë¼ë¯¸í„°ì¸ errì— trueê°€ ë“¤ì–´ê°€ê²Œ ë˜ê³ , ê·¸ë•Œì— ì˜ˆì™¸ì²˜ë¦¬ë¥¼ í•´ì¤€ë‹¤.
- ë§Œì•½, errê°€ ë°œìƒí•˜ì§€ ì•Šì•˜ë‹¤ë©´, rowsì— ìš”ì²­í•œ ë°ì´í„°ê°€ ì €ì¥ëœë‹¤. `[ RowDataPacket { name: 'crong' } ]`

htmlì—ì„œ `document.querySelector(".result").innerHTML = result.name;`ë¶€ë¶„ì„ ì¶”ê°€í•´  í˜ì´ì§€ì— ì´ë¦„ì„ ë„ì–´ë³´ë©´ ê²°ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

```html
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>email form</title>
</head>
<body>
	<form action="/email_post" method="post">
		email : <input type="text" name="email"><br/>
		<input type="submit">
	</form>
	<button class="ajaxsend">ajaxsend</button>

	<div class="result"></div>

	<script>
		document.querySelector(".ajaxsend").addEventListener('click', function(){
			const inputData = document.forms[0].elements[0].value;
			sendAjax("http://localhost:3000/ajax_send_email", inputData);
		})

		function sendAjax(url, data){
			const JSONdata = JSON.stringify({email : data});
			const xhr = new XMLHttpRequest();

			xhr.open('POST', url);
			xhr.setRequestHeader('content-Type', 'application/json');
			xhr.send(JSONdata);
			xhr.addEventListener('load', function(){
				console.log(xhr.responseText);
				const result  = JSON.parse(xhr.responseText);
				let resultDiv = document.querySelector(".result");
				if(result.result !== 'ok') resultDiv.innerHTML = "you email is not found";
				else resultDiv.innerHTML = result.name;
			})
		}
	</script>

</body>
</html>
```

