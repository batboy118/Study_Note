# 08. Callback

> ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ Callbackì— ëŒ€í•´ í•™ìŠµ

[ğŸ Home](https://github.com/batboy118/Study_Note)

[â—€Previous page ](./README.md)

---

<!-- TOC -->

- [1. callback](#1-callback)
- [2. callback Hell](#2-callback-hell)
- [3. Promise](#3-promise)
- [4. Promise Chaining](#4-promise-chaining)
- [5. callback Hell Promiseë¡œ ê°œì„ í•˜ê¸°](#5-callback-hell-promiseë¡œ-ê°œì„ í•˜ê¸°)
- [6. async & await](#6-async--await)
	- [6.1. async](#61-async)
	- [6.2. await](#62-await)
- [7. callback Hell async & awaitìœ¼ë¡œ ê°œì„ í•˜ê¸°](#7-callback-hell-async--awaitìœ¼ë¡œ-ê°œì„ í•˜ê¸°)

<!-- /TOC -->

## 1. callback

callbackì€ ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ë¹„ë™ê¸°ì˜ ì‹œì‘ì´ë‹¤.

ë³´í†µ ìë°”ìŠ¤í¬ë¦½íŠ¸ëŠ” ë™ê¸°ì–¸ì–´ì´ì§€ë§Œ, callbackì„ ì“°ë©´ ë¹„ë™ê¸°ì ìœ¼ë¡œ ë™ì‘í•˜ê²Œ ëœë‹¤.

ì˜ˆë¥¼ë“¤ì–´ ì•„ë˜ setTimeoutìœ¼ë¡œ ì „ë‹¬ëœ í•¨ìˆ˜ê°€ callback í•¨ìˆ˜ì´ë‹¤.

```js
setTimeout(function () {
	console.log('2');
}, 1000);
```

callbackí•¨ìˆ˜ë„ ë‘ ê°€ì§€ë¡œ ë‚˜ëˆŒ ìˆ˜ ìˆë‹¤.

- ë™ê¸° ì½œë°±

  ```js
  function printNow(print){
      print();
  }
  printNow(()=>console.log("Hello"));
  ```

- ë¹„ë™ê¸° ì½œë°±

  ```js
  function printNow(print){
      setTimeout(()=>console.log("Hello"), 1000);
  }
  printNow(()=>console.log("Hello"));
  ```

## 2. callback Hell

ì½œë°± ì§€ì˜¥ì˜ ì˜ˆì‹œë¥¼ ì‚´í´ë³´ì.

```js
class UserStorage {
    loginUser(id, password, onSuccess, onError){
        setTimeout(() => {
            if(
                (id === 'jason' && password === 'bear') ||
                (id === 'peter' && password === 'bat')
            ) {
                onSuccess(id);
            } else {
                onError(new Error('not found'));
            }
        }, 2000);
    }

    getRoles(user, onSuccess, onError){
        setTimeout(() => {
            if(user === 'jason') {
                onSuccess({name: 'jason', role: 'admin'});
            } else {
                onError(new Error('no access'));
            }
        },1000);
    }
}

const userStorage = new UserStorage();
const id = prompt ('endter your id');
const password = prompt ('endter your password');
userStorage.loginUser(
    id,
    password,
    (user) => {
        userStorage.getRoles(
            user,
            (uerWithRole) => {
                alert(`Hello ${uerWithRole.name}, you are ${uerWithRole.role}!`)
            },
            (error) => {console.log("Error")}
        )},
    (error) => {console.log("Error")}
)
```

- ìœ„ ì½”ë“œëŠ” idì™€ passwordë¥¼ ì…ë ¥í•˜ì—¬ ë¡œê·¸ì¸í•˜ê³ , ì—­í• ì„ ë°›ê³ , ìœ ì €ë¥¼ í™•ì¸í•˜ì—¬ ì¶œë ¥í•œë‹¤.

- ê°€ë…ì„±ì´ ì¢‹ì§€ ì•Šë‹¤.
- ë””ë²„ê¹…í•˜ê¸° ì–´ë µë‹¤.
- ìœ ì§€ë³´ìˆ˜ë„ ì–´ë µë‹¤.

## 3. Promise

promiseëŠ” ë¹„ë™ê¸°ë¥¼ ê°„í¸í•˜ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì œê³µí•´ì£¼ëŠ” Objectì´ë‹¤.

ì¸ìŠ¤í„´ìŠ¤ì— ë¹„ë™ê¸°ì ìœ¼ë¡œ ìƒíƒœê°€ ê°±ì‹ ë˜ê³ , ê°’ì´ ì €ì¥ëœë‹¤.

PromiseëŠ” ì •í•´ì§„ ë¹„ë™ê¸° ì‘ì—…ì´ ì •ìƒì ìœ¼ë¡œ ì²˜ë¦¬ê°€ ë˜ì—ˆë‹¤ë©´, ì„±ê³ ì˜ ë©”ì„¸ì§€ì™€ í•¨ê»˜ ê²°ê³¼ê°’ì„ ì „ë‹¬í•´ì£¼ê³ , ì‹¤íŒ¨í•˜ë©´ ì—ëŸ¬ë¥¼ ë˜ì ¸ì¤€ë‹¤.

ë¹„ë™ê¸°ì ì¸ ê²ƒì„ ì‹¤í–‰í•  ë•Œ ì½œë°±í•¨ìˆ˜ ëŒ€ì‹ ì— ì“°ì¸ë‹¤.

promiseë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ìƒíƒœ(state), ì œê³µì(producer), ì†Œë¹„ì(consumer)ì— ëŒ€í•œ ì´í•´ê°€ í•„ìš”í•˜ë‹¤.

- state

  - pending : Promiseê°€ ë§Œë“¤ì–´ì ¸ì„œ ì§€ì •ëœ ì‘ì—…ì´ ì‹¤í–‰ë˜ëŠ” ìƒíƒœ
  - fulfilled : ì •í•´ì§„ ì‘ì—…ì„ ëë‚¸ ìƒíƒœ
  - rejected : ë¬¸ì œê°€ ë°œìƒí•œ ìƒíƒœ

- producer : í”„ë¡œë¯¸ìŠ¤ë¥¼ ë§Œë“œëŠ” ê²ƒ

  ```js
  const promise = new Promise((resolve, reject) => {
      console.log('doing Something');
      setTimeout(() => {
          resolve('jason');
      }, 2000);
  })
  //doing Something
  ```

  - promiseëŠ” resolveì™€ rejectë¥¼ ê°€ì§€ëŠ” excutor(callback) í•¨ìˆ˜ë¥¼ ë°›ëŠ”ë‹¤.
  - ë³´í†µ ë¹„ë™ê¸°ëŠ” ì—°ì‚°ëŸ‰ì´ ë§ì€ ì‘ì—…ì— ì‚¬ìš©ì„ í•˜ê²Œ ëœë‹¤.
  - **promise ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“œëŠ” ê²ƒë§Œìœ¼ë¡œë„, ì½œë°±í•¨ìˆ˜ê°€ ì‹¤í–‰ì´ ëœë‹¤!**
    - doing Somethingì´ ì¶œë ¥ëœë‹¤.
    - ì´ê²ƒì„ í•­ìƒ ì—¼ë‘í•´ì•¼ í•œë‹¤.(ì£¼ì˜)
  - ìœ„ ì˜ˆì‹œì—ì„œëŠ” 2ì´ˆ í›„ì— resolveë¼ëŠ” í•¨ìˆ˜ì— jason ìŠ¤íŠ¸ë§ì„ ì¸ìë¡œ ì£¼ì–´ ì‹¤í–‰í•œë‹¤.

  ```js
  const promise = new Promise((resolve, reject) => {
      setTimeout(() => {
          reject(new Error('no network'));
      }, 2000);
  })
  ```

  - rejectí•¨ìˆ˜ë¥¼ ì‹¤í–‰ì‹œí‚¬ ë•ŒëŠ” ë³´í†µ Error ê°ì²´ë¥¼ ìƒì„±í•´ì„œ ì „ë‹¬í•´ì£¼ëŠ”ë°, ìœ„ ì½”ë“œì˜ ê²½ìš° 2ì´ˆ í›„ì— ì—ëŸ¬ë¥¼ ë°œìƒì‹œì¼œ í”„ë¡œê·¸ë¨ì„ ì£½ì¸ë‹¤.

- consumer : í”„ë¡œë¯¸ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒ

  - then, catch, finally ë¥¼ ì´ìš©í•´ì„œ ê°’ì„ ë°›ì•„ ì˜¬ ìˆ˜ ìˆë‹¤.

  ```js
  const promise = new Promise((resolve, reject) => {
      setTimeout(() => {
          resolve('jason');
      }, 2000);
  })

  promise.then((value) => {
      console.log(value);
  })
  //jason
  ```

  - thenì€ í”„ë¡œë¯¸ìŠ¤ì—ì„œ resolveë¡œ ì „ë‹¬í•œ ê°’ì„ íŒŒë¼ë¯¸í„°ë¡œ ë°›ì•„ì„œ ì‹¤í–‰ì‹œì¼œì¤€ë‹¤.

  ```js
  const promise = new Promise((resolve, reject) => {
      setTimeout(() => {
          reject(new Error('no network'));
      }, 2000);
  })

  promise
      .then((value) => {
      console.log(value);
  })
      .catch(error => {
      console.log(error);
  });
  //error
  ```

  - ì—ëŸ¬ê°€ ë°œìƒí–ˆì„ ë•Œ í”„ë¡œê·¸ë¨ì„ ë©ˆì¶”ì§€ ì•Šê³  íŠ¹ë³„í•œ ì²˜ë¦¬ë¥¼ í•˜ê³  ì‹¶ë‹¤ë©´ `catch`ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.
  - ìœ„ ì½”ë“œëŠ” ì½˜ì†”ì— error ê°ì²´ë¥¼ ì¶œë ¥í• ë¿ í”„ë¡œê·¸ë¨ì„ ì£½ì´ì§€ëŠ” ì•ŠëŠ”ë‹¤.
  - ìœ„ ì½”ë“œì˜ ì²´ì´ë‹ì´ ê°€ëŠ¥í•œ ì´ìœ ëŠ”, `then`ì€ **promise ê°ì²´**ë¥¼ ë¦¬í„´í•˜ê¸° ë•Œë¬¸ì´ë‹¤.

  ìµœê·¼ì—ëŠ” **finally**ë¼ëŠ” ë©”ì„œë“œê°€ ì¶”ê°€ë˜ì—ˆëŠ”ë°,  ì´ ì½”ë“œëŠ” resolveë‚˜ rejectì— ê´€ê³„ ì—†ì´ ë¬´ì¡°ê±´ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜ì´ë‹¤.

  ```js
  const promise = new Promise((resolve, reject) => {
      setTimeout(() => {
          reject(new Error('no network'));
      }, 2000);
  })

  promise
      .then((value) => {
      console.log(value);
  })
      .catch(error => {
      console.log(error);
  })
      .finally(()=>{
      console.log("Always")
  });
  //error
  ```

> resolveí•¨ìˆ˜ë‚˜ reject í•¨ìˆ˜ê°€ ì‹¤í–‰ë  ë–„ ê¹Œì§€ `pending`ìƒíƒœì´ë‹¤.

## 4. Promise Chaining

```js
const fetchNumber = new Promise((resolve, reject) => {
    setTimeout(() => resolve(3), 2000);
})

fetchNumber
    .then(num => num * 2)   // 6
    .then(num => num * 3)   // 18
    .then(num => {
    return new Promise((resolve, reject) => {
        setTimeout(() => resolve(num - 1), 1000);    //17
    });
})
    .then(num => console.log(num));
//17
```

- thenì€ ê°’ì´ ì½œë°±í•¨ìˆ˜ì˜ ë¦¬í„´ê°’ìœ¼ë¡œ ê°±ì‹ ëœ ìƒˆë¡œìš´ Promise ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤. ë‚´ë¶€ì ìœ¼ë¡œ ì½œë°±í•¨ìˆ˜ì˜ ë¦¬í„´ê°’ì´ í”„ë¡œë¯¸ìŠ¤ ê°ì²´ì´ë©´ ê·¸ í”„ë¡œë¯¸ìŠ¤ ê°ì²´ê°€ ìƒì„±ë˜ë©° thenì˜ ë¦¬í„´ê°‘ ìì²´ê°€ ëœë‹¤.

ìƒˆë¡œìš´ ì˜ˆì‹œë¥¼ ì‚´í´ë³´ì.

```js
const getHen = () => new Promise((resolve, reject) => {
    setTimeout(() => resolve("ë‹­"), 1000)
});

const getEgg = hen => new Promise((resolve, reject) => {
    setTimeout(() => resolve(`${hen} => "ë‹¬ê±€"`), 1000)
});

const cook = egg => new Promise((resolve, reject) => {
    setTimeout(() => resolve(`${egg} => "ìš”ë¦¬"`), 1000)
});

getHen()
    .then(hen => getEgg(hen))
    .then(egg => cook(egg))
    .then(meal => console.log(meal))
//ë‹­ => "ë‹¬ê±€" => "ìš”ë¦¬"
```

- ìœ„ ì½”ë“œë¥¼ ì¡°ê¸ˆë” ê°„ë‹¨íˆ í•  ìˆ˜ ìˆë‹¤.
- ë§¤ê°œë³€ìˆ˜ì™€ ì½œë°±í•¨ìˆ˜ì˜ ì¸ìê°€ ê°™ë‹¤ë©´ ìƒëµí•  ìˆ˜ ìˆë‹¤.

```js
getHen()
    .then(getEgg)
    .then(cook)
    .then(console.log)
```

ë§Œì•½ ì¤‘ê°„ì— ì—ëŸ¬ê°€ ë°œìƒí–ˆë‹¤ê³  ê°€ì •í•˜ê³ , ì—ëŸ¬ê°€ ë°œìƒí–ˆì„ ê²½ìš° ëŒ€ì²˜ë¥¼ í•´ì£¼ëŠ” ë°©ë²•ì„ ì•Œì•„ë³´ì.

```js
const getHen = () => new Promise((resolve, reject) => {
    setTimeout(() => resolve("ë‹­"), 1000)
});

const getEgg = hen => new Promise((resolve, reject) => {
    setTimeout(() => reject(new Error(`Error: ${hen} => "ë‹¬ê±€"`)), 1000)
});

const cook = egg => new Promise((resolve, reject) => {
    setTimeout(() => resolve(`${egg} => ìš”ë¦¬`), 1000)
});

getHen()
    .then(getEgg)
    .then(cook)
    .then(console.log)
	.catch(console.log)
//Error: Error: ë‹­ => "ë‹¬ê±€"
```

- ìœ„ì™€ ê°™ì´ catchì—ì„œ ì—ëŸ¬ë¥¼ ì¡ëŠ”ë‹¤. í•˜ì§€ë§Œ ì—ëŸ¬ë¥¼ ë°œìƒì‹œí‚¤ì§€ ì•Šê³ , ë‹¬ê±€ì„ ë‹¤ë¥¸ ê²ƒìœ¼ë¡œ ëŒ€ì²´í•˜ì—¬ ë¬¸ì œ ì—†ì´ ë™ì‘ì‹œí‚¬ ìˆ˜ ìˆë‹¤.

```js
getHen()
    .then(getEgg)
    .catch(error => "ë¹µ")
    .then(cook)
    .then(console.log)
//ë¹µ => "ìš”ë¦¬"
```

- ì¤‘ê°„ì— ì—ëŸ¬ê°€ ë°œìƒ í–ˆë”ë¼ë„, ë‹¬ê±€ ëŒ€ì‹  ë¹µìœ¼ë¡œ ëŒ€ì²´ëœ í”„ë¡œë¯¸ìŠ¤ê°€ ì „ë‹¬ë˜ëŠ” ê²ƒì´ë‹¤.

## 5. callback Hell Promiseë¡œ ê°œì„ í•˜ê¸°

```js
class UserStorage {
    loginUser(id, password, onSuccess, onError){
        setTimeout(() => {
            if(
                (id === 'jason' && password === 'bear') ||
                (id === 'peter' && password === 'bat')
            ) {
                onSuccess(id);
            } else {
                onError(new Error('not found'));
            }
        }, 2000);
    }

    getRoles(user, onSuccess, onError){
        setTimeout(() => {
            if(user === 'jason') {
                onSuccess({name: 'jason', role: 'admin'});
            } else {
                onError(new Error('no access'));
            }
        },1000);
    }
}

const userStorage = new UserStorage();
const id = prompt ('endter your id');
const password = prompt ('endter your password');
userStorage.loginUser(
    id,
    password,
    (user) => {
        userStorage.getRoles(
            user,
            (uerWithRole) => {
                alert(`Hello ${uerWithRole.name}, you are ${uerWithRole.role}!`)
            },
            (error) => {console.log("Error")}
        )},
    (error) => {console.log("Error")}
)
```

ìœ„ ì½”ë“œë¥¼ promiseë¥¼ ì´ìš©í•´ ë°”ê¾¸ì–´ ë³´ì.

```js
class UserStorage {
    loginUser(id, password){
        return new Promise((resolve, reject) => {
            setTimeout(() => {
                if(
                    (id === 'jason' && password === 'bear') ||
                    (id === 'peter' && password === 'bat')
                ) {
                    resolve(id);
                } else {
                    reject(new Error('not found'));
                }
            }, 2000);
        });
    }

    getRoles(user){
        return new Promise((resolve, reject) => {
            setTimeout(() => {
                if(user === 'jason') {
                    resolve({name: 'jason', role: 'admin'});
                } else {
                    reject(new Error('no access'));
                }
            },1000);
        })
    }
}

const userStorage = new UserStorage();
const id = prompt ('endter your id');
const password = prompt ('endter your password');
userStorage.loginUser(id, password)
    .then(userStorage.getRoles)
    .then(user => alert(`Hello ${user.name}, you are ${user.role}!`));
	.catch(console.log)
```

- í›¨ì”¬ ê°„ë‹¨í•´ ì¡Œë‹¤.

## 6. async & await

async & await ì€ promiseë¥¼ ì¡°ê¸ˆ ë” ê°„ê²°í•˜ê³ , ê°„í¸í•˜ê³  ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” ê²ƒ ì²˜ëŸ¼ ë³´ì´ê²Œ ë§Œë“¤ì–´ ì¤€ë‹¤.

ì—¬ëŸ¬ê°œì˜ promise ì²´ì´ë‹ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒë³´ë‹¤ ì¡°ê¸ˆ ë” ì¢‹ì€ ë°©ë²•ì´ ë˜ê¸°ë„ í•œë‹¤.

ê¸°ì¡´ì— ì¡´ì¬í•˜ëŠ” promiseìœ„ì— ë§Œë“¤ì–´ ì§„ ê²ƒì´ë‹¤.

### 6.1. async

```js
function fetchUser() {
    return new Promise((resolve, reject) => {
        ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ë“± (ì˜¤ë˜ê±¸ë¦¬ëŠ” ì‘ì—…)
        resolve ('jason');
    });
}

const user = fetchUser();
user.then(console.log);
```

ìœ„ ì½”ë“œë¥¼ `async`ë¥¼ ì´ìš©í•´ ì¡°ê¸ˆë” ì‰½ê²Œ ë°”ê¿€ ìˆ˜ ìˆë‹¤.

í•¨ìˆ˜ ì•ì— async ë¥¼ ë¶™ì—¬ì£¼ê³  ê°’ì„ ë¦¬í„´ë§Œ í•´ì£¼ë©´ ëœë‹¤.

```js
async function fetchUser() {
    //ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ë“± (ì˜¤ë˜ê±¸ë¦¬ëŠ” ì‘ì—…)
    return ('jason');
}

const user = fetchUser();
user.then(console.log);
```

### 6.2. await

awaitì€ asyncê°€ ë¶™ì€ í•¨ìˆ˜ì—ì„œë§Œ ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ë‹¤.

í”„ë¡œë¯¸ìŠ¤ê°ì²´ ë˜ëŠ” í”„ë¡œë¯¸ìŠ¤ ê°ì²´ë¥¼ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ ì•ì— ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```js
function delay(ms) {
    return new Promis(resolve => setTimeout(resolve, ms));
}

async function getApple() {
    await delay(2000);
    return ('ì‚¬ê³¼');
}

async function getBanana() {
    await delay(2000);
    return ('ë°”ë‚˜ë‚˜');
}

//ìœ„ ì½”ë“œë¥¼ Promiseë¡œ ë°”ê¾¸ë©´ ì•„ë˜ì™€ ê°™ë‹¤.
async function getBanana() {
    return delay(2000)
        .then(() => "ë°”ë‚˜ë‚˜")
}
```

- í”„ë¡œë¯¸ìŠ¤ë¥¼ ì‚¬ìš©í•œ ì²´ì´ë‹ë³´ë‹¤ awaitì„ ì“°ëŠ”ê²ƒì´ ì½”ë“œê°€ ë” ë™ê¸°ì ìœ¼ë¡œ ì½íŒë‹¤.

```js
function delay(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}

async function getApple() {
    await delay(2000);
    return ('ì‚¬ê³¼');
}

async function getBanana() {
    await delay(2000);
    return ('ë°”ë‚˜ë‚˜');
}

function pickFruits() {
    return getApple().then(apple => {
        return getBanana().then(banana => `${apple} + ${banana}`)
    });
}

pickFruits().then(console.log);
//ì‚¬ê³¼ + ë°”ë‚˜ë‚˜
```

- ìœ„ ì½”ë“œë¥¼ ë³´ë©´ í”„ë¡œë¯¸ìŠ¤ë„ ì½œë°±ì§€ì˜¥ê³¼ ìœ ì‚¬í•œ ëª¨ìŠµì„ ë³´ì¸ë‹¤.
- pickFruitsí•¨ìˆ˜ë¥¼ ë°”ê¾¸ì–´ë³´ì.

```js
async function pickFruits() {
    console.log("getting Apple")
    const apple = await getApple();
    console.log("getting Banana")
    const banana = await getBanana();
    return  `${apple} + ${banana}`
}

pickFruits().then(console.log);
//getting Apple
// 2ì´ˆ
//getting Banana
// 2ì´ˆ
//ì‚¬ê³¼ + ë°”ë‚˜ë‚˜
```

- ìœ„ ì½”ë“œëŠ” ë¬¸ì œê°€ ìˆë‹¤.
- Appleê³¼ Bananaë¥¼ ìˆ˜ì§‘í•˜ëŠ” ê²ƒì„ ë³‘ë ¬ë¡œ ì²˜ë¦¬í•˜ê³  ì‹¶ì€ë°, ìˆœì„œì— ë”°ë¼ ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬ëœë‹¤.
- ì¦‰ 4ì´ˆê°€ ê±¸ë¦°ë‹¤.
- í”„ë¡œë¯¸ìŠ¤ë¥¼ í™œìš©í•˜ì—¬ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆë‹¤.

```js
async function pickFruits() {
    const applePromise = getApple();
    const bananaPromise = getBanana();
    const apple = await applePromise;
    const banana = await bananaPromise;
    return  `${apple} + ${banana}`
}

pickFruits().then(console.log);
```

- ìœ„ ì½”ë“œëŠ” 2ì´ˆë§Œì— ë§Œë“¤ì–´ì§„ë‹¤.
- í•˜ì§€ë§Œ, ì½”ë“œê°€ ì¢€ ì§€ì €ë¶„í•´ì§„ë‹¤. ì´ê²½ìš°ëŠ” promiseì—ì„œ ì œê³µí•˜ëŠ” APIë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

```js
function pickAllFruits() {
    return Promise.all([getApple(), getBanana()])
    .then(fruits => fruits.join(' + '));
}

pickAllFruits().then(console.log);
//ì‚¬ê³¼ + ë°”ë‚˜ë‚˜
```

- Promise ê°ì²´ì˜ static ë©”ì„œë“œì¸ `all` ë©”ì„œë“œëŠ”, í”„ë¡œë¯¸ìŠ¤ë“¤ì„ ë°°ì—´ í˜•íƒœë¡œë°›ì•„ì„œ, í”„ë¡œë¯¸ìŠ¤ë¥¼ ìƒì„±í•´ì£¼ëŠ”ë° ê·¸ë•Œ ê°ê°ì˜ í”„ë¡œë¯¸ìŠ¤ ê°’ì€ ë°°ì—´í˜•íƒœë¡œ ì €ì¥ì´ ëœë‹¤.

ì•„ë˜ `race` ë©”ì„œë“œëŠ” ë°°ì—´ì— ìˆëŠ” í”„ë¡œë¯¸ìŠ¤ë“¤ ì¤‘ **ê°€ì¥ ë¨¼ì € ê²°ê³¼ë¥¼ ë°›ëŠ” í”„ë¡œë¯¸ìŠ¤ ë§Œ** ë¦¬í„´í•œë‹¤.

```js
function pickOnlyOneFruits() {
    return Promise.race([getApple(), getBanana()])
    .then(fruits => fruits);
}

pickOnlyOneFruits().then(console.log);
//ì‚¬ê³¼
```

>  ì—ëŸ¬ ì²˜ë¦¬ëŠ” ì•„ë˜ê°™ì´ í•˜ë©´ ëœë‹¤.

```js
async function pickFruits() {
    try{
        const apple = await getApple();
        const banana = await getBanana();
    } catch() {
        //ì—ëŸ¬ ì²˜ë¦¬
    }
    return  `${apple} + ${banana}`
}
```

## 7. callback Hell async & awaitìœ¼ë¡œ ê°œì„ í•˜ê¸°

```js
class UserStorage {
    async loginUser(id, password){
        return new Promise((resolve, reject) => {
            setTimeout(() => {
                if(
                    (id === 'jason' && password === 'bear') ||
                    (id === 'peter' && password === 'bat')
                ) {
                    resolve(id);
                } else {
                    reject(new Error('not found'));
                }
            }, 2000);
        });
    }

    async getRoles(user){
        return new Promise((resolve, reject) => {
            setTimeout(() => {
                if(user === 'jason') {
                    resolve({name: 'jason', role: 'admin'});
                } else {
                    reject(new Error('no access'));
                }
            },1000);
        })
    }
}

const userStorage = new UserStorage();
const id = prompt ('endter your id');
const password = prompt ('endter your password');

async function checkUser() {
  const login = await userStorage.loginUser(id, password);
  const role = await userStorage.getRoles(id);
  return `hello! ${role.name}, you have a ${role.role} role`;
}

checkUser()
    .then(alert)
    .catch(console.log);
```

