# 08. Callback

> ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ Callbackì— ëŒ€í•´ í•™ìŠµ

[ğŸ Home](https://github.com/batboy118/Study_Note)

[â—€Previous page ](./README.md)

---

<!-- TOC -->

- [1. ìƒì„±](#1-ìƒì„±)
- [2. ì ‘ê·¼](#2-ì ‘ê·¼)
- [3. ìˆœíšŒ ë°©ë²• 4ê°€ì§€](#3-ìˆœíšŒ-ë°©ë²•-4ê°€ì§€)
- [4. ì¶”ê°€](#4-ì¶”ê°€)
- [5. ì‚­ì œ](#5-ì‚­ì œ)
- [6. ê²€ìƒ‰](#6-ê²€ìƒ‰)
- [7. ìì£¼ ì‚¬ìš©ë˜ëŠ” ë°°ì—´ê´€ë ¨ APIë“¤](#7-ìì£¼-ì‚¬ìš©ë˜ëŠ”-ë°°ì—´ê´€ë ¨-apië“¤)

<!-- /TOC -->

## 1. callback

callbackì€ ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ë¹„ë™ê¸°ì˜ ì‹œì‘ì´ë‹¤.

ë³´í†µ ìë°”ìŠ¤í¬ë¦½íŠ¸ëŠ” ë™ê¸°ì–¸ì–´ì´ì§€ë§Œ, callbackì„ ì“°ë©´ ë¹„ë™ê¸°ì ìœ¼ë¡œ ë™ì‘í•˜ê²Œ ëœë‹¤.

ì˜ˆë¥¼ë“¤ì–´ ì•„ë˜ setTimeoutìœ¼ë¡œ ì „ë‹¬ëœ í•¨ìˆ˜ê°€ callback í•¨ìˆ˜ì´ë‹¤.

```js
setTimeout(function () {
	console.log('2');
}, 1000);
```

callbackí•¨ìˆ˜ë„ ë‘ ê°€ì§€ë¡œ ë‚˜ëˆŒ ìˆ˜ ìˆë‹¤.

- ë™ê¸° ì½œë°±

  ```js
  function printNow(print){
      print();
  }
  printNow(()=>console.log("Hello"));
  ```

- ë¹„ë™ê¸° ì½œë°±

  ```js
  function printNow(print){
      setTimeout(()=>console.log("Hello"), 1000);
  }
  printNow(()=>console.log("Hello"));
  ```

## 2. callback Hell

ì½œë°± ì§€ì˜¥ì˜ ì˜ˆì‹œë¥¼ ì‚´í´ë³´ì.

```js
class UserStorage {
    loginUser(id, password, onSuccess, onError){
        setTimeout(() => {
            if(
                (id === 'jason' && password === 'bear') ||
                (id === 'peter' && password === 'bat')
            ) {
                onSuccess(id);
            } else {
                onError(new Error('not found'));
            }
        }, 2000);
    }

    getRoles(user, onSuccess, onError){
        setTimeout(() => {
            if(user === 'jason') {
                onSuccess({name: 'jason', role: 'admin'});
            } else {
                onError(new Error('no access'));
            }
        },1000);
    }
}

const userStorage = new UserStorage();
const id = prompt ('endter your id');
const password = prompt ('endter your password');
userStorage.loginUser(
    id, 
    password, 
    (user) => { 
        userStorage.getRoles(
            user, 
            (uerWithRole) => {
                alert(`Hello ${uerWithRole.name}, you are ${uerWithRole.role}!`)
            },
            (error) => {console.log("Error")}
        )}, 
    (error) => {console.log("Error")}
)
```

- ìœ„ ì½”ë“œëŠ” idì™€ passwordë¥¼ ì…ë ¥í•˜ì—¬ ë¡œê·¸ì¸í•˜ê³ , ì—­í• ì„ ë°›ê³ , ìœ ì €ë¥¼ í™•ì¸í•˜ì—¬ ì¶œë ¥í•œë‹¤.

- ê°€ë…ì„±ì´ ì¢‹ì§€ ì•Šë‹¤.
- ë””ë²„ê¹…í•˜ê¸° ì–´ë µë‹¤.
- ìœ ì§€ë³´ìˆ˜ë„ ì–´ë µë‹¤.

## 3. Promise

promiseëŠ” ë¹„ë™ê¸°ë¥¼ ê°„í¸í•˜ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì œê³µí•´ì£¼ëŠ” Objectì´ë‹¤.

PromiseëŠ” ì •í•´ì§„ ë¹„ë™ê¸° ì‘ì—…ì´ ì •ìƒì ìœ¼ë¡œ ì²˜ë¦¬ê°€ ë˜ì—ˆë‹¤ë©´, ì„±ê³ ì˜ ë©”ì„¸ì§€ì™€ í•¨ê»˜ ê²°ê³¼ê°’ì„ ì „ë‹¬í•´ì£¼ê³ , ì‹¤íŒ¨í•˜ë©´ ì—ëŸ¬ë¥¼ ë˜ì ¸ì¤€ë‹¤.

ë¹„ë™ê¸°ì ì¸ ê²ƒì„ ì‹¤í–‰í•  ë•Œ ì½œë°±í•¨ìˆ˜ ëŒ€ì‹ ì— ì“°ì¸ë‹¤.

promiseë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ìƒíƒœ(state), ì œê³µì(producer), ì†Œë¹„ì(consumer)ì— ëŒ€í•œ ì´í•´ê°€ í•„ìš”í•˜ë‹¤.

- state

  - pending : Promiseê°€ ë§Œë“¤ì–´ì ¸ì„œ ì§€ì •ëœ ì‘ì—…ì´ ì‹¤í–‰ë˜ëŠ” ìƒíƒœ
  - fulfilled : ì •í•´ì§„ ì‘ì—…ì„ ëë‚¸ ìƒíƒœ
  - rejected : ë¬¸ì œê°€ ë°œìƒí•œ ìƒíƒœ

- producer : í”„ë¡œë¯¸ìŠ¤ë¥¼ ë§Œë“œëŠ” ê²ƒ

  ```js
  const promise = new Promise((resolve, reject) => {
      console.log('doing Something');
      setTimeout(() => {
          resolve('jason');
      }, 2000);
  })
  //doing Something
  ```

  - promiseëŠ” resolveì™€ rejectë¥¼ ê°€ì§€ëŠ” excutor(callback) í•¨ìˆ˜ë¥¼ ë°›ëŠ”ë‹¤.
  - ë³´í†µ ë¹„ë™ê¸°ëŠ” ì—°ì‚°ëŸ‰ì´ ë§ì€ ì‘ì—…ì— ì‚¬ìš©ì„ í•˜ê²Œ ëœë‹¤.
  - **promise ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“œëŠ” ê²ƒë§Œìœ¼ë¡œë„, ì½œë°±í•¨ìˆ˜ê°€ ì‹¤í–‰ì´ ëœë‹¤!**
    - doing Somethingì´ ì¶œë ¥ëœë‹¤.
    - ì´ê²ƒì„ í•­ìƒ ì—¼ë‘í•´ì•¼ í•œë‹¤.(ì£¼ì˜)
  - ìœ„ ì˜ˆì‹œì—ì„œëŠ” 2ì´ˆ í›„ì— resolveë¼ëŠ” í•¨ìˆ˜ì— jason ìŠ¤íŠ¸ë§ì„ ì¸ìë¡œ ì£¼ì–´ ì‹¤í–‰í•œë‹¤.

  ```js
  const promise = new Promise((resolve, reject) => {
      setTimeout(() => {
          reject(new Error('no network'));
      }, 2000);
  })
  ```

  - rejectí•¨ìˆ˜ë¥¼ ì‹¤í–‰ì‹œí‚¬ ë•ŒëŠ” ë³´í†µ Error ê°ì²´ë¥¼ ìƒì„±í•´ì„œ ì „ë‹¬í•´ì£¼ëŠ”ë°, ìœ„ ì½”ë“œì˜ ê²½ìš° 2ì´ˆ í›„ì— ì—ëŸ¬ë¥¼ ë°œìƒì‹œì¼œ í”„ë¡œê·¸ë¨ì„ ì£½ì¸ë‹¤.

- consumer : í”„ë¡œë¯¸ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒ

  - then, catch, finally ë¥¼ ì´ìš©í•´ì„œ ê°’ì„ ë°›ì•„ ì˜¬ ìˆ˜ ìˆë‹¤.

  ```js
  const promise = new Promise((resolve, reject) => {
      setTimeout(() => {
          resolve('jason');
      }, 2000);
  })
  
  promise.then((value) => {
      console.log(value);  
  })
  //jason
  ```

  - thenì€ í”„ë¡œë¯¸ìŠ¤ì—ì„œ resolveë¡œ ì „ë‹¬í•œ ê°’ì„ íŒŒë¼ë¯¸í„°ë¡œ ë°›ì•„ì„œ ì‹¤í–‰ì‹œì¼œì¤€ë‹¤.

  ```js
  const promise = new Promise((resolve, reject) => {
      setTimeout(() => {
          reject(new Error('no network'));
      }, 2000);
  })
  
  promise
      .then((value) => {
      console.log(value);  
  })
      .catch(error => {
      console.log(error);
  });
  //error
  ```

  - ì—ëŸ¬ê°€ ë°œìƒí–ˆì„ ë•Œ í”„ë¡œê·¸ë¨ì„ ë©ˆì¶”ì§€ ì•Šê³  íŠ¹ë³„í•œ ì²˜ë¦¬ë¥¼ í•˜ê³  ì‹¶ë‹¤ë©´ `catch`ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.
  - ìœ„ ì½”ë“œëŠ” ì½˜ì†”ì— error ê°ì²´ë¥¼ ì¶œë ¥í• ë¿ í”„ë¡œê·¸ë¨ì„ ì£½ì´ì§€ëŠ” ì•ŠëŠ”ë‹¤.
  - ìœ„ ì½”ë“œì˜ ì²´ì´ë‹ì´ ê°€ëŠ¥í•œ ì´ìœ ëŠ”, `then`ì€ **promise ê°ì²´**ë¥¼ ë¦¬í„´í•˜ê¸° ë•Œë¬¸ì´ë‹¤.

  ìµœê·¼ì—ëŠ” **finally**ë¼ëŠ” ë©”ì„œë“œê°€ ì¶”ê°€ë˜ì—ˆëŠ”ë°,  ì´ ì½”ë“œëŠ” resolveë‚˜ rejectì— ê´€ê³„ ì—†ì´ ë¬´ì¡°ê±´ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜ì´ë‹¤.

  ```js
  const promise = new Promise((resolve, reject) => {
      setTimeout(() => {
          reject(new Error('no network'));
      }, 2000);
  })
  
  promise
      .then((value) => {
      console.log(value);  
  })
      .catch(error => {
      console.log(error);
  })
      .finally(()=>{
      console.log("Always")
  });
  //error
  ```

## 4. Promise Chaining

```js
const fetchNumber = new Promise
```



